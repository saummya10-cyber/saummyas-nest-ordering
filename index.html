<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saummya's Nest</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f59e0b;
            --primary-dark: #d97706;
            --primary-light: #fbbf24;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #ef4444;
            --bg: #fffbf0;
            --surface: #ffffff;
            --text: #1c1917;
            --text-light: #78716c;
            --border: #e7e5e4;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.08);
            --shadow-lg: 0 20px 40px -8px rgba(0,0,0,0.12);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        h1, h2, h3, .brand { font-family: 'Playfair Display', serif; }

        /* LOADER */
        .loader {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loader-logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 2rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #fde68a;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loader-text {
            margin-top: 1rem;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, #1c1917 0%, #292524 100%);
            color: white;
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 200;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--primary-light);
            letter-spacing: -0.5px;
        }

        .brand-icon {
            font-size: 1.8rem;
        }

        .header-btns {
            display: flex;
            gap: 0.75rem;
        }

        .btn-icon {
            background: rgba(245,158,11,0.15);
            border: 1px solid rgba(245,158,11,0.3);
            color: var(--primary-light);
            padding: 0.625rem 1.1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.25s;
            font-family: 'DM Sans', sans-serif;
        }

        .btn-icon:hover {
            background: rgba(245,158,11,0.25);
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        /* BANNERS */
        .banner-container {
            margin: 1.25rem;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            position: relative;
            height: 260px;
        }

        .banner-slide {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.7s ease;
            display: flex;
            align-items: flex-end;
        }

        .banner-slide.active { opacity: 1; }

        .banner-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.1) 60%);
        }

        .banner-content {
            position: relative;
            z-index: 2;
            padding: 1.75rem;
            color: white;
            width: 100%;
        }

        .banner-tag {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 0.35rem 0.875rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .banner-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.9rem;
            font-weight: 800;
            margin-bottom: 0.35rem;
            line-height: 1.2;
        }

        .banner-desc {
            font-size: 1rem;
            opacity: 0.9;
        }

        .banner-dots {
            position: absolute;
            bottom: 1rem;
            right: 1.5rem;
            display: flex;
            gap: 0.4rem;
            z-index: 3;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.45);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dot.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }

        /* CATEGORIES */
        .categories {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            overflow-x: auto;
            position: sticky;
            top: 64px;
            background: var(--bg);
            z-index: 100;
            scrollbar-width: none;
            border-bottom: 1px solid var(--border);
        }

        .categories::-webkit-scrollbar { display: none; }

        .category-pill {
            white-space: nowrap;
            padding: 0.625rem 1.25rem;
            background: white;
            border: 1.5px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.25s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-family: 'DM Sans', sans-serif;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .category-pill:hover {
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        .category-pill.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(245,158,11,0.35);
        }

        /* MENU */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.25rem;
        }

        .section-title {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--text);
            margin: 1.75rem 0 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 2px;
            background: linear-gradient(to right, var(--primary-light), transparent);
            margin-left: 0.5rem;
            border-radius: 2px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
            gap: 1.25rem;
        }

        .menu-card {
            background: white;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1.5px solid var(--border);
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .menu-card.unavailable { opacity: 0.6; filter: grayscale(0.3); }

        .card-image {
            height: 185px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            position: relative;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s;
        }

        .menu-card:hover .card-image img { transform: scale(1.06); }

        .badges {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .badge {
            padding: 0.3rem 0.7rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-new { background: var(--secondary); color: white; }
        .badge-sale { background: var(--accent); color: white; }
        .badge-hot { background: #f97316; color: white; }
        .badge-best { background: #8b5cf6; color: white; }

        .out-of-stock {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.65);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }

        .card-body { padding: 1.25rem; }

        .item-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.4rem;
        }

        .item-desc {
            color: var(--text-light);
            font-size: 0.85rem;
            margin-bottom: 0.875rem;
            line-height: 1.5;
        }

        .combo-box {
            background: #fef9ec;
            border: 1px solid #fde68a;
            padding: 0.625rem;
            border-radius: 10px;
            font-size: 0.825rem;
            margin-bottom: 0.875rem;
            color: #92400e;
        }

        .price-row {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            margin-bottom: 0.75rem;
        }

        .price-main {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--primary-dark);
            font-family: 'Playfair Display', serif;
        }

        .price-old {
            font-size: 1rem;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .save-badge {
            background: var(--secondary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .savings-bar {
            background: linear-gradient(90deg, #d1fae5, #a7f3d0);
            color: var(--secondary-dark);
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 0.875rem;
        }

        .card-actions {
            display: flex;
            gap: 0.625rem;
            align-items: center;
        }

        .qty-stepper {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: var(--bg);
            padding: 0.3rem;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .stepper-btn {
            width: 34px;
            height: 34px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stepper-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.08);
        }

        .stepper-btn:disabled { background: #d1d5db; cursor: not-allowed; }

        .qty-value {
            min-width: 36px;
            text-align: center;
            font-weight: 700;
            font-size: 1.05rem;
        }

        .add-cart-btn {
            flex: 1;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.25s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            font-family: 'DM Sans', sans-serif;
        }

        .add-cart-btn:hover:not(:disabled) {
            background: var(--secondary-dark);
            transform: scale(1.02);
        }

        .add-cart-btn:disabled { background: #d1d5db; cursor: not-allowed; }

        /* MODALS */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            width: 100%;
            max-width: 600px;
            max-height: 92vh;
            border-radius: 28px 28px 0 0;
            overflow: hidden;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #1c1917, #292524);
            color: white;
            padding: 1.25rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary-light);
        }

        .close-btn {
            background: rgba(255,255,255,0.12);
            border: none;
            color: white;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover { background: rgba(255,255,255,0.2); transform: rotate(90deg); }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 78vh;
        }

        /* CART */
        .cart-item {
            display: flex;
            gap: 0.875rem;
            padding: 0.875rem;
            background: var(--bg);
            border-radius: 14px;
            margin-bottom: 0.875rem;
            border: 1px solid var(--border);
        }

        .cart-item-img {
            width: 72px;
            height: 72px;
            border-radius: 10px;
            object-fit: cover;
            background: #e5e7eb;
            flex-shrink: 0;
        }

        .cart-item-info { flex: 1; }

        .cart-item-name { font-weight: 700; margin-bottom: 0.2rem; font-size: 0.95rem; }
        .cart-item-price { color: var(--primary-dark); font-weight: 600; margin-bottom: 0.4rem; font-size: 0.875rem; }

        .cart-item-qty { display: flex; align-items: center; gap: 0.4rem; }

        .qty-btn-sm {
            width: 26px;
            height: 26px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn-sm:hover { background: var(--primary-dark); }

        .remove-btn {
            background: #fee2e2;
            color: var(--accent);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            align-self: flex-start;
        }

        .cart-summary {
            background: linear-gradient(135deg, #fef9ec, #fef3c7);
            padding: 1.25rem;
            border-radius: 16px;
            margin-top: 0.875rem;
            border: 1px solid #fde68a;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.625rem;
            font-size: 1rem;
        }

        .summary-total {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary-dark);
            border-top: 2px solid var(--primary-light);
            padding-top: 0.875rem;
            margin-top: 0.875rem;
            font-family: 'Playfair Display', serif;
        }

        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 1.1rem;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.25s;
            font-family: 'DM Sans', sans-serif;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16,185,129,0.3);
        }

        /* FORMS */
        .form-group { margin-bottom: 1.25rem; }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text);
            font-size: 0.9rem;
        }

        .form-label span { color: var(--accent); }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.25s;
            background: white;
            font-family: 'DM Sans', sans-serif;
            color: var(--text);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(245,158,11,0.12);
        }

        .radio-group { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }

        .radio-option { position: relative; }
        .radio-option input { position: absolute; opacity: 0; }

        .radio-label {
            display: block;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            text-align: center;
            transition: all 0.25s;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .radio-option input:checked + .radio-label {
            border-color: var(--primary);
            background: linear-gradient(135deg, #fef9ec, #fef3c7);
            color: var(--primary-dark);
        }

        .conditional-field { display: none; animation: fadeIn 0.3s; }
        .conditional-field.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-options { display: flex; flex-direction: column; gap: 0.75rem; }

        .payment-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border: 2px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s;
        }

        .payment-card:hover { border-color: var(--primary-light); }
        .payment-card.selected { border-color: var(--primary); background: linear-gradient(135deg, #fef9ec, #fef3c7); }

        .payment-icon { font-size: 1.75rem; }

        .payment-info { flex: 1; }
        .payment-title { font-weight: 700; margin-bottom: 0.15rem; font-size: 0.95rem; }
        .payment-subtitle { font-size: 0.8rem; color: var(--text-light); }

        /* UPI INSTRUCTIONS */
        .instructions-box {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #93c5fd;
            border-radius: 16px;
            padding: 1.25rem;
            margin: 1.25rem 0;
        }

        .instructions-title {
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .instructions-list { list-style: none; counter-reset: steps; }

        .instructions-list li {
            counter-increment: steps;
            margin-bottom: 0.625rem;
            padding-left: 2.25rem;
            position: relative;
            font-size: 0.9rem;
        }

        .instructions-list li::before {
            content: counter(steps);
            position: absolute;
            left: 0;
            top: 0;
            width: 26px;
            height: 26px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .amount-display {
            text-align: center;
            font-size: 2.25rem;
            font-weight: 900;
            color: var(--primary-dark);
            margin: 0.875rem 0;
            font-family: 'Playfair Display', serif;
        }

        /* SUCCESS */
        .success-box { text-align: center; padding: 1.5rem; }

        .success-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            margin: 0 auto 1.25rem;
            animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .order-id-box {
            background: linear-gradient(135deg, #fef9ec, #fef3c7);
            padding: 1.25rem;
            border-radius: 16px;
            margin: 1.25rem 0;
            border: 2px solid var(--primary-light);
        }

        .order-id-label { color: var(--text-light); font-size: 0.8rem; margin-bottom: 0.4rem; text-transform: uppercase; letter-spacing: 1px; }
        .order-id-value { font-size: 1.6rem; font-weight: 800; color: var(--primary-dark); font-family: 'Courier New', monospace; }

        /* ADMIN */
        .admin-view { display: none; }
        .admin-view.active { display: block; }

        .admin-header {
            background: linear-gradient(135deg, #1c1917, #292524);
            color: white;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
        }

        .admin-header h2 { color: var(--primary-light); font-size: 1.5rem; }

        .admin-refresh {
            background: rgba(245,158,11,0.2);
            border: 1px solid rgba(245,158,11,0.4);
            color: var(--primary-light);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .admin-refresh:hover { background: rgba(245,158,11,0.3); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.75rem;
        }

        .stat-box {
            background: white;
            padding: 1.25rem;
            border-radius: 16px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .stat-box.pending { border-left-color: var(--accent); }
        .stat-box.confirmed { border-left-color: #3b82f6; }
        .stat-box.revenue { border-left-color: var(--secondary); }

        .stat-number { font-size: 2.2rem; font-weight: 900; color: var(--text); font-family: 'Playfair Display', serif; }
        .stat-label { color: var(--text-light); font-size: 0.8rem; margin-top: 0.25rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        .orders-grid { display: flex; flex-direction: column; gap: 1rem; }

        .order-box {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: all 0.25s;
        }

        .order-box:hover { transform: translateX(3px); }
        .order-box.pending { border-left-color: var(--accent); }
        .order-box.confirmed { border-left-color: #3b82f6; }
        .order-box.completed { border-left-color: var(--secondary); }
        .order-box.cancelled { border-left-color: #9ca3af; opacity: 0.75; }

        .order-top { display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; }
        .order-num { font-size: 1.1rem; font-weight: 800; color: var(--primary-dark); font-family: 'Playfair Display', serif; }
        .order-time { font-size: 0.8rem; color: var(--text-light); margin-top: 0.2rem; }

        .status-badge {
            padding: 0.4rem 0.875rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending { background: #fee2e2; color: var(--accent); }
        .status-confirmed { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: var(--secondary-dark); }
        .status-cancelled { background: #f3f4f6; color: #6b7280; }

        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.625rem;
            margin-bottom: 1rem;
            padding: 0.875rem;
            background: var(--bg);
            border-radius: 10px;
        }

        .detail-row { display: flex; flex-direction: column; }
        .detail-label { font-size: 0.7rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-value { font-weight: 600; margin-top: 0.2rem; font-size: 0.9rem; }

        .order-items {
            background: #f9fafb;
            padding: 0.875rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .order-instructions {
            background: #eff6ff;
            padding: 0.75rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            border-left: 3px solid #93c5fd;
            color: #1e40af;
        }

        .order-actions { display: flex; gap: 0.625rem; flex-wrap: wrap; }

        .action-btn {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
        }

        .btn-confirm { background: linear-gradient(135deg, var(--secondary), var(--secondary-dark)); color: white; }
        .btn-complete { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-cancel { background: #fee2e2; color: var(--accent); }
        .btn-whatsapp { background: #25d366; color: white; }
        .action-btn:hover { transform: translateY(-1px); filter: brightness(1.05); }

        /* LOGIN */
        .login-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active { display: flex; }

        .login-card {
            background: white;
            padding: 2.25rem;
            border-radius: 22px;
            width: 90%;
            max-width: 380px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
        }

        .login-title { text-align: center; margin-bottom: 1.5rem; color: var(--primary-dark); font-size: 1.5rem; }

        .login-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 1rem;
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.25s;
        }

        .login-input:focus { outline: none; border-color: var(--primary); }

        .login-btn {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
        }

        .login-btn:hover { filter: brightness(1.05); }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 1.75rem;
            right: 1.75rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 8px 25px rgba(245,158,11,0.45);
            cursor: pointer;
            z-index: 99;
            transition: all 0.3s;
        }

        .fab:hover { transform: scale(1.1); box-shadow: 0 12px 35px rgba(245,158,11,0.5); }

        .fab-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            border: 2px solid white;
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            padding: 0.875rem 1.25rem;
            border-radius: 14px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            display: none;
            align-items: center;
            gap: 0.875rem;
            z-index: 3000;
            border-left: 4px solid var(--secondary);
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            max-width: 280px;
        }

        @keyframes slideInRight {
            from { transform: translateX(110%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.show { display: flex; }
        .notif-icon { font-size: 1.4rem; }
        .notif-text { font-weight: 600; font-size: 0.9rem; }

        /* LOADING SPINNER for admin */
        .loading-spinner {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .loading-spinner .spinner {
            margin: 0 auto 1rem;
            width: 40px;
            height: 40px;
        }

        .total-highlight {
            background: linear-gradient(135deg, #fef9ec, #fef3c7);
            padding: 1rem 1.25rem;
            border-radius: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.25rem 0;
            border: 1px solid #fde68a;
        }

        @media (max-width: 768px) {
            .banner-container { height: 200px; margin: 0.875rem; }
            .banner-title { font-size: 1.5rem; }
            .menu-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .order-details { grid-template-columns: 1fr; }
            .brand { font-size: 1.3rem; }
        }

        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .radio-group { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<!-- LOADER -->
<div class="loader" id="loader">
    <div class="loader-logo">ü™∫ Saummya's Nest</div>
    <div class="spinner"></div>
    <p class="loader-text">Loading menu from Google Sheets...</p>
</div>

<!-- NOTIFICATION -->
<div class="notification" id="notification">
    <span class="notif-icon">üîî</span>
    <span class="notif-text" id="notifText">New order received!</span>
</div>

<!-- LOGIN MODAL -->
<div class="login-modal" id="loginModal">
    <div class="login-card">
        <h2 class="login-title">üîê Admin Login</h2>
        <input type="password" class="login-input" id="loginPass" placeholder="Enter admin password" onkeydown="if(event.key==='Enter')doLogin()">
        <button class="login-btn" onclick="doLogin()">Login to Dashboard</button>
        <p style="text-align: center; margin-top: 1rem;">
            <a href="#" onclick="closeLogin()" style="color: var(--text-light); font-size: 0.9rem;">Cancel</a>
        </p>
    </div>
</div>

<!-- HEADER -->
<header class="header">
    <div class="header-content">
        <div class="brand">
            <span class="brand-icon">ü™∫</span>
            <span>Saummya's Nest</span>
        </div>
        <div class="header-btns">
            <button class="btn-icon" onclick="openCart()">
                üõí <span id="headerCartCount">0</span>
            </button>
            <button class="btn-icon" onclick="showLogin()">
                üîê Admin
            </button>
        </div>
    </div>
</header>

<!-- CUSTOMER VIEW -->
<div class="customer-view" id="customerView">
    <div class="banner-container" id="bannerContainer"></div>
    <div class="categories" id="categories"></div>
    <div class="container" id="menuSection"></div>
</div>

<!-- ADMIN VIEW -->
<div class="admin-view" id="adminView">
    <div class="admin-header">
        <div style="max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
            <div>
                <h2>üìä Dashboard</h2>
                <p style="color: var(--text-light); margin-top: 0.25rem; font-size: 0.9rem;">Orders from Google Sheets ‚Äî Live</p>
            </div>
            <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
                <button class="admin-refresh" onclick="loadAdminOrders()">üîÑ Refresh</button>
                <button class="admin-refresh" onclick="logout()" style="background:rgba(239,68,68,0.15); border-color:rgba(239,68,68,0.4); color:#fca5a5;">üö™ Logout</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="stats-grid" id="statsGrid"></div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; flex-wrap:wrap; gap:0.75rem;">
            <h3 style="font-size:1.2rem; font-weight:700;">Recent Orders</h3>
            <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                <button onclick="filterOrders('all')" class="category-pill active" id="filterAll">All</button>
                <button onclick="filterOrders('PENDING')" class="category-pill" id="filterPENDING">‚è≥ Pending</button>
                <button onclick="filterOrders('CONFIRMED')" class="category-pill" id="filterCONFIRMED">‚úÖ Confirmed</button>
                <button onclick="filterOrders('COMPLETED')" class="category-pill" id="filterCOMPLETED">üéâ Completed</button>
            </div>
        </div>

        <div class="orders-grid" id="ordersGrid"></div>
    </div>
</div>

<!-- CART MODAL -->
<div class="modal-overlay" id="cartModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">üõí Your Cart</span>
            <button class="close-btn" onclick="closeCart()">√ó</button>
        </div>
        <div class="modal-body" id="cartBody"></div>
    </div>
</div>

<!-- CHECKOUT MODAL -->
<div class="modal-overlay" id="checkoutModal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title" id="checkoutTitle">üìã Checkout</span>
            <button class="close-btn" onclick="closeCheckout()">√ó</button>
        </div>
        <div class="modal-body" id="checkoutBody"></div>
    </div>
</div>

<!-- FAB -->
<div class="fab" onclick="openCart()">
    üõí
    <span class="fab-count" id="fabCount">0</span>
</div>

<script>
// ==========================================
// CONFIGURATION
// ==========================================
const CONFIG = {
    BUSINESS_NAME: "Saummya's Nest",
    WHATSAPP_NUMBER: "917363039591",
    UPI_ID: "8617322648@axl",
    ADMIN_PASSWORD: "nest2026",
    TOTAL_TABLES: 10,
    APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzW0f_2--G_-Kodt8dfKif2S93K0l_-7ZP-C9hw9qHKjWgTrtGYBMJSgpyIoHYXm3JMbQ/exec',
    // Published sheet tabs (CSV)
    MENU_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDWtew0ZASIILQsfOGqDnW3Zflj19XEkuFD_S7cmw72Bz05R0a-GWw-kdQ7WPuCe2kp3khK4iSJjIy/pub?gid=0&single=true&output=csv',
    BANNERS_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDWtew0ZASIILQsfOGqDnW3Zflj19XEkuFD_S7cmw72Bz05R0a-GWw-kdQ7WPuCe2kp3khK4iSJjIy/pub?gid=0&single=true&output=csv',
};

// ==========================================
// STATE
// ==========================================
let menuData = [];
let banners = [];
let cart = {};
let quantities = {};
let adminOrders = [];
let currentFilter = 'all';
let orderSerial = parseInt(localStorage.getItem('sn_orderSerial') || '999');
let audioCtx = null;
let bannerInterval = null;

// ==========================================
// INIT
// ==========================================
window.addEventListener('load', init);

async function init() {
    try {
        await loadFromSheets();
        renderAll();
        hideLoader();
    } catch (e) {
        console.error('Failed to load:', e);
        showError('Failed to load menu. Please check your connection and try again.');
    }
}

function hideLoader() {
    document.getElementById('loader').style.display = 'none';
}

function showError(msg) {
    document.getElementById('loader').innerHTML = `
        <div style="text-align:center; padding:2rem;">
            <div style="font-size:3rem; margin-bottom:1rem;">‚ö†Ô∏è</div>
            <p style="color:var(--accent); font-size:1.1rem; margin-bottom:0.5rem;">${msg}</p>
            <button onclick="location.reload()" style="margin-top:1.5rem; padding:0.875rem 2rem; background:var(--primary); color:white; border:none; border-radius:12px; cursor:pointer; font-weight:700; font-family:'DM Sans',sans-serif;">Retry</button>
        </div>
    `;
}

// ==========================================
// LOAD FROM SHEETS
// ==========================================
async function loadFromSheets() {
    // Try loading from the single published CSV (which shows the first tab)
    // Use the main URL which defaults to the first tab (Menu)
    const menuUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDWtew0ZASIILQsfOGqDnW3Zflj19XEkuFD_S7cmw72Bz05R0a-GWw-kdQ7WPuCe2kp3khK4iSJjIy/pub?output=csv';
    
    const [menuRes] = await Promise.all([fetch(menuUrl)]);
    
    if (!menuRes.ok) throw new Error('Failed to fetch menu sheet');
    
    const menuCSV = await menuRes.text();
    parseSheetData(menuCSV);
}

function parseSheetData(csv) {
    const lines = csv.split('\n').filter(l => l.trim());
    menuData = [];
    banners = [];
    
    for (let i = 1; i < lines.length; i++) {
        const row = parseCSVLine(lines[i]);
        if (!row || row.length < 2) continue;
        
        const type = (row[0] || '').trim();
        
        if (type === 'Banner') {
            banners.push({
                title: (row[1] || '').trim(),
                description: (row[5] || '').trim(),
                image: (row[6] || '').trim(),
                tag: (row[7] || '').trim(),
                active: (row[9] || '').toLowerCase().trim() === 'yes'
            });
        } else if (type === 'Item' || type === 'Combo') {
            const item = {
                id: `item-${i}`,
                type,
                name: (row[1] || '').trim(),
                category: (row[2] || 'Other').trim(),
                price: parseInt(row[3]) || 0,
                oldPrice: parseInt(row[4]) || 0,
                description: (row[5] || '').trim(),
                image: (row[6] || '').trim(),
                tags: row[7] ? row[7].split(',').map(t => t.trim()).filter(Boolean) : [],
                comboItems: (row[8] || '').trim(),
                available: (row[9] || '').toLowerCase().trim() === 'yes'
            };
            if (item.name && item.price > 0) {
                menuData.push(item);
                quantities[item.id] = 0;
            }
        }
    }
}

function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
            if (inQuotes && line[i+1] === '"') { current += '"'; i++; }
            else inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            result.push(current.trim().replace(/^"|"$/g, ''));
            current = '';
        } else if (char !== '\r') {
            current += char;
        }
    }
    result.push(current.trim().replace(/^"|"$/g, ''));
    return result;
}

// ==========================================
// RENDER
// ==========================================
function renderAll() {
    renderBanners();
    renderCategories();
    renderMenu();
}

function renderBanners() {
    const active = banners.filter(b => b.active);
    const container = document.getElementById('bannerContainer');
    
    if (!active.length) {
        container.style.display = 'none';
        return;
    }
    
    let currentBanner = 0;
    
    container.innerHTML = active.map((b, i) => `
        <div class="banner-slide ${i === 0 ? 'active' : ''}" style="${b.image ? `background-image: url('${b.image}')` : 'background: linear-gradient(135deg,#f59e0b,#d97706)'}">
            <div class="banner-overlay"></div>
            <div class="banner-content">
                ${b.tag ? `<span class="banner-tag">${b.tag}</span>` : ''}
                <h2 class="banner-title">${b.title}</h2>
                ${b.description ? `<p class="banner-desc">${b.description}</p>` : ''}
            </div>
        </div>
    `).join('') + `
        <div class="banner-dots">
            ${active.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToBanner(${i})"></div>`).join('')}
        </div>
    `;
    
    if (active.length > 1) {
        if (bannerInterval) clearInterval(bannerInterval);
        bannerInterval = setInterval(() => {
            currentBanner = (currentBanner + 1) % active.length;
            goToBanner(currentBanner);
        }, 4500);
    }
}

window.goToBanner = (index) => {
    document.querySelectorAll('.banner-slide').forEach((s, i) => s.classList.toggle('active', i === index));
    document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === index));
};

function renderCategories() {
    const cats = [...new Set(menuData.map(i => i.category))];
    const emojis = {
        'Beverages': '‚òï', 'Starters': 'ü•ò', 'Main Course': 'üçõ',
        'Desserts': 'üç∞', 'Combos': 'üéÅ', 'Breakfast': 'üç≥',
        'Snacks': 'üçø', 'Drinks': 'ü•§', 'Fast Food': 'üçî',
        'Rice': 'üçö', 'Noodles': 'üçú', 'Sandwich': 'ü•™',
        'Rolls': 'üåØ', 'Biryani': 'üçõ', 'Momos': 'ü•ü',
        'Pasta': 'üçù', 'Pizza': 'üçï', 'Salad': 'ü•ó',
        'Soup': 'üç≤', 'Ice Cream': 'üç¶', 'Shakes': 'ü•§',
        'Coffee': '‚òï', 'Tea': 'üçµ', 'Juice': 'üßÉ',
    };
    
    document.getElementById('categories').innerHTML = cats.map((c, i) => `
        <button class="category-pill ${i === 0 ? 'active' : ''}" onclick="setCategory('${c}', this)">
            ${emojis[c] || 'üçΩÔ∏è'} ${c}
        </button>
    `).join('');
}

window.setCategory = (cat, btn) => {
    document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderMenu(cat);
    
    // Smooth scroll to menu
    document.getElementById('menuSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
};

function renderMenu(filterCat = null) {
    const cats = filterCat ? [filterCat] : [...new Set(menuData.map(i => i.category))];
    
    document.getElementById('menuSection').innerHTML = cats.map(cat => {
        const items = menuData.filter(i => i.category === cat);
        if (!items.length) return '';
        return `
            <h2 class="section-title">${getCatEmoji(cat)} ${cat}</h2>
            <div class="menu-grid">
                ${items.map(item => renderItem(item)).join('')}
            </div>
        `;
    }).join('');
}

function getCatEmoji(cat) {
    const emojis = {
        'Beverages': '‚òï', 'Starters': 'ü•ò', 'Main Course': 'üçõ',
        'Desserts': 'üç∞', 'Combos': 'üéÅ', 'Breakfast': 'üç≥',
        'Snacks': 'üçø', 'Drinks': 'ü•§', 'Fast Food': 'üçî',
        'Rice': 'üçö', 'Noodles': 'üçú', 'Sandwich': 'ü•™',
    };
    return emojis[cat] || 'üçΩÔ∏è';
}

function renderItem(item) {
    const discount = item.oldPrice && item.oldPrice > item.price ? Math.round((1 - item.price/item.oldPrice) * 100) : 0;
    const unavailable = !item.available;
    
    return `
        <div class="menu-card ${unavailable ? 'unavailable' : ''}">
            <div class="card-image">
                ${item.image ? `<img src="${item.image}" alt="${item.name}" loading="lazy" onerror="this.style.display='none'">` : ''}
                <div class="badges">
                    ${item.tags.map(tag => {
                        let cls = 'badge-sale';
                        const t = tag.toLowerCase();
                        if (t.includes('new')) cls = 'badge-new';
                        else if (t.includes('hot')) cls = 'badge-hot';
                        else if (t.includes('best')) cls = 'badge-best';
                        return `<span class="badge ${cls}">${tag}</span>`;
                    }).join('')}
                </div>
                ${unavailable ? '<div class="out-of-stock">OUT OF STOCK</div>' : ''}
            </div>
            <div class="card-body">
                <h3 class="item-name">${item.name}</h3>
                ${item.description ? `<p class="item-desc">${item.description}</p>` : ''}
                ${item.comboItems ? `<div class="combo-box">üéÅ <strong>Includes:</strong> ${item.comboItems}</div>` : ''}
                <div class="price-row">
                    <span class="price-main">‚Çπ${item.price}</span>
                    ${item.oldPrice > item.price ? `<span class="price-old">‚Çπ${item.oldPrice}</span>` : ''}
                    ${discount > 0 ? `<span class="save-badge">-${discount}%</span>` : ''}
                </div>
                ${discount > 0 ? `<div class="savings-bar">üí∞ You save ‚Çπ${item.oldPrice - item.price}!</div>` : ''}
                <div class="card-actions">
                    <div class="qty-stepper">
                        <button class="stepper-btn" onclick="changeQty('${item.id}', -1)" ${unavailable ? 'disabled' : ''}>‚àí</button>
                        <span class="qty-value" id="qty-${item.id}">0</span>
                        <button class="stepper-btn" onclick="changeQty('${item.id}', 1)" ${unavailable ? 'disabled' : ''}>+</button>
                    </div>
                    <button class="add-cart-btn" onclick="addToCart('${item.id}', event)" ${unavailable ? 'disabled' : ''}>
                        ${unavailable ? '‚ùå Unavailable' : 'üõí Add to Cart'}
                    </button>
                </div>
            </div>
        </div>
    `;
}

// ==========================================
// CART LOGIC
// ==========================================
window.changeQty = (id, delta) => {
    quantities[id] = Math.max(0, (quantities[id] || 0) + delta);
    const el = document.getElementById(`qty-${id}`);
    if (el) el.textContent = quantities[id];
};

window.addToCart = (id, e) => {
    const qty = quantities[id] || 0;
    if (!qty) {
        // Auto increment and add
        quantities[id] = 1;
        const el = document.getElementById(`qty-${id}`);
        if (el) el.textContent = 1;
        setTimeout(() => doAddToCart(id, e), 10);
        return;
    }
    doAddToCart(id, e);
};

function doAddToCart(id, e) {
    const qty = quantities[id] || 0;
    if (!qty) return;
    
    const item = menuData.find(i => i.id === id);
    if (!item?.available) return;
    
    if (cart[id]) cart[id].qty += qty;
    else cart[id] = { ...item, qty };
    
    quantities[id] = 0;
    const el = document.getElementById(`qty-${id}`);
    if (el) el.textContent = '0';
    
    updateCartCount();
    
    // Visual feedback
    const btn = e ? e.target : null;
    if (btn) {
        btn.innerHTML = '‚úì Added!';
        btn.style.background = 'var(--primary)';
        setTimeout(() => {
            btn.innerHTML = 'üõí Add to Cart';
            btn.style.background = '';
        }, 1200);
    }
    
    showNotification(`${item.name} added to cart! üõí`);
}

function updateCartCount() {
    const count = Object.values(cart).reduce((sum, i) => sum + i.qty, 0);
    document.getElementById('headerCartCount').textContent = count;
    document.getElementById('fabCount').textContent = count;
}

window.openCart = () => { renderCart(); document.getElementById('cartModal').classList.add('active'); };
window.closeCart = () => { document.getElementById('cartModal').classList.remove('active'); };

function renderCart() {
    const items = Object.values(cart);
    const body = document.getElementById('cartBody');
    
    if (!items.length) {
        body.innerHTML = `
            <div style="text-align:center; padding:3rem; color:var(--text-light);">
                <div style="font-size:4rem; margin-bottom:1rem;">üõí</div>
                <p style="font-size:1.1rem; font-weight:600;">Your cart is empty</p>
                <p style="font-size:0.875rem; margin-top:0.5rem;">Add some delicious items!</p>
            </div>`;
        return;
    }
    
    const total = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
    
    body.innerHTML = `
        <div>
            ${items.map(item => `
                <div class="cart-item">
                    <img src="${item.image || ''}" class="cart-item-img" onerror="this.style.background='#f3f4f6'; this.style.display='block'">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">‚Çπ${item.price} each</div>
                        <div class="cart-item-qty">
                            <button class="qty-btn-sm" onclick="updateCartQty('${item.id}', -1)">‚àí</button>
                            <span style="font-weight:700; min-width:28px; text-align:center;">${item.qty}</span>
                            <button class="qty-btn-sm" onclick="updateCartQty('${item.id}', 1)">+</button>
                        </div>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:flex-end; gap:0.5rem;">
                        <div style="font-weight:800; font-size:1.05rem;">‚Çπ${item.price * item.qty}</div>
                        <button class="remove-btn" onclick="removeCartItem('${item.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('')}
        </div>
        <div class="cart-summary">
            <div class="summary-row"><span>Subtotal</span><span>‚Çπ${total}</span></div>
            <div class="summary-row"><span>Taxes</span><span>Included</span></div>
            <div class="summary-row summary-total"><span>Total</span><span>‚Çπ${total}</span></div>
            <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout ‚Üí</button>
        </div>
    `;
}

window.updateCartQty = (id, delta) => {
    cart[id].qty += delta;
    if (cart[id].qty <= 0) delete cart[id];
    updateCartCount();
    renderCart();
};

window.removeCartItem = (id) => {
    delete cart[id];
    updateCartCount();
    renderCart();
};

// ==========================================
// CHECKOUT
// ==========================================
window.openCheckout = () => {
    closeCart();
    const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
    
    document.getElementById('checkoutTitle').textContent = 'üìã Checkout';
    document.getElementById('checkoutBody').innerHTML = `
        <div class="form-group">
            <label class="form-label">Full Name <span>*</span></label>
            <input type="text" class="form-input" id="custName" required placeholder="Your full name">
        </div>
        
        <div class="form-group">
            <label class="form-label">Phone Number <span>*</span></label>
            <input type="tel" class="form-input" id="custPhone" required placeholder="+91 98765 43210">
        </div>
        
        <div class="form-group">
            <label class="form-label">Order Type <span>*</span></label>
            <div class="radio-group">
                <div class="radio-option">
                    <input type="radio" name="orderType" value="dine-in" id="typeDine" checked onchange="toggleTable()">
                    <label class="radio-label" for="typeDine">üçΩÔ∏è Dine In</label>
                </div>
                <div class="radio-option">
                    <input type="radio" name="orderType" value="pickup" id="typePickup" onchange="toggleTable()">
                    <label class="radio-label" for="typePickup">üõçÔ∏è Pickup</label>
                </div>
            </div>
        </div>
        
        <div class="conditional-field active form-group" id="tableSection">
            <label class="form-label">Table Number <span>*</span></label>
            <select class="form-select" id="tableNum">
                ${Array.from({length: CONFIG.TOTAL_TABLES}, (_, i) =>
                    `<option value="${i+1}">Table ${i+1}</option>`
                ).join('')}
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-textarea form-input" id="custInstructions" placeholder="Any special requests, allergies, or notes for the kitchen..."></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">Payment Method <span>*</span></label>
            <div class="payment-options">
                <div class="payment-card selected" onclick="selectPayment(this,'counter')">
                    <span class="payment-icon">üíµ</span>
                    <div class="payment-info">
                        <div class="payment-title">Pay at Counter</div>
                        <div class="payment-subtitle">Cash, Card or UPI at cafe</div>
                    </div>
                </div>
                <div class="payment-card" onclick="selectPayment(this,'upi')">
                    <span class="payment-icon">üì±</span>
                    <div class="payment-info">
                        <div class="payment-title">Pay Now via UPI</div>
                        <div class="payment-subtitle">Google Pay, PhonePe, Paytm</div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="paymentMethod" value="counter">
        </div>
        
        <div class="total-highlight">
            <span style="font-weight:600;">Total Amount</span>
            <span style="font-size:1.75rem; font-weight:900; color:var(--primary-dark); font-family:'Playfair Display',serif;">‚Çπ${total}</span>
        </div>
        
        <button onclick="processCheckout()" class="checkout-btn">Place Order üöÄ</button>
    `;
    
    document.getElementById('checkoutModal').classList.add('active');
};

window.closeCheckout = () => { document.getElementById('checkoutModal').classList.remove('active'); };

window.toggleTable = () => {
    const isDine = document.getElementById('typeDine').checked;
    document.getElementById('tableSection').classList.toggle('active', isDine);
};

window.selectPayment = (el, method) => {
    document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    document.getElementById('paymentMethod').value = method;
};

window.processCheckout = () => {
    const name = (document.getElementById('custName').value || '').trim();
    const phone = (document.getElementById('custPhone').value || '').trim();
    const type = document.querySelector('input[name="orderType"]:checked')?.value;
    const payment = document.getElementById('paymentMethod').value;
    const instructions = (document.getElementById('custInstructions').value || '').trim();
    const isDine = type === 'dine-in';
    const table = isDine ? document.getElementById('tableNum')?.value : null;
    
    if (!name) return alert('Please enter your name');
    if (!phone) return alert('Please enter your phone number');
    
    const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
    const now = new Date();
    
    // Generate Order ID: SN-DDMMYYYY-SERIAL
    orderSerial++;
    localStorage.setItem('sn_orderSerial', orderSerial);
    
    const dd = String(now.getDate()).padStart(2, '0');
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const yyyy = now.getFullYear();
    const orderId = `SN-${dd}${mm}${yyyy}-${orderSerial}`;
    
    const order = {
        orderId,
        timestamp: now.toLocaleString('en-IN'),
        date: `${dd}/${mm}/${yyyy}`,
        time: now.toTimeString().slice(0, 5),
        name,
        phone,
        items: Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(', '),
        total,
        type: isDine ? 'Dine In' : 'Pickup',
        location: isDine ? `Table ${table}` : 'Pickup Counter',
        payment: payment === 'upi' ? 'UPI (Pending)' : 'Pay at Counter',
        instructions: instructions || '',
        status: 'PENDING'
    };
    
    if (payment === 'upi') {
        showUPIScreen(order);
    } else {
        saveAndComplete(order);
    }
};

function showUPIScreen(order) {
    const amount = order.total;
    const upiLink = `upi://pay?pa=${CONFIG.UPI_ID}&pn=${encodeURIComponent(CONFIG.BUSINESS_NAME)}&am=${amount}&cu=INR&tn=Order_${order.orderId}`;
    
    document.getElementById('checkoutBody').innerHTML = `
        <div class="instructions-box">
            <div class="instructions-title">üì± UPI Payment Steps</div>
            <ol class="instructions-list">
                <li>Click <strong>"Open UPI App"</strong> below to open your payment app</li>
                <li>Complete payment of <strong>‚Çπ${amount}</strong> to ${CONFIG.BUSINESS_NAME}</li>
                <li>Return here after payment and click <strong>"Payment Done ‚úÖ"</strong></li>
                <li>WhatsApp will open ‚Äî send the message to confirm your order</li>
            </ol>
        </div>
        
        <div class="amount-display">‚Çπ${amount}</div>
        
        <a href="${upiLink}" class="checkout-btn" style="display:block; text-align:center; text-decoration:none; margin-bottom:0.875rem; background:linear-gradient(135deg,#f59e0b,#d97706); color:white;">
            üì± Open UPI App
        </a>
        
        <button class="checkout-btn" onclick="upiPaymentDone()" style="background:linear-gradient(135deg,var(--secondary),var(--secondary-dark));">
            ‚úÖ Payment Done ‚Äî Confirm Order
        </button>
        
        <button onclick="window._pendingOrder=undefined; openCheckout()" style="width:100%; padding:0.875rem; background:#f3f4f6; border:none; border-radius:12px; margin-top:0.875rem; cursor:pointer; font-family:'DM Sans',sans-serif; font-weight:600;">
            ‚Üê Back to Checkout
        </button>
    `;
    
    window._pendingOrder = order;
}

window.upiPaymentDone = async () => {
    const order = window._pendingOrder;
    if (!order) return;
    order.payment = 'UPI (Paid)';
    await saveAndComplete(order);
};

async function saveAndComplete(order) {
    // Show saving state
    document.getElementById('checkoutBody').innerHTML = `
        <div style="text-align:center; padding:3rem;">
            <div class="spinner" style="margin:0 auto 1rem;"></div>
            <p style="color:var(--text-light);">Saving your order...</p>
        </div>
    `;
    
    // Save to Google Sheets via Apps Script
    try {
        await fetch(CONFIG.APPS_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({
                orderId: order.orderId,
                timestamp: order.timestamp,
                name: order.name,
                phone: order.phone,
                items: order.items,
                total: order.total,
                type: order.type,
                location: order.location,
                payment: order.payment,
                status: order.status,
                instructions: order.instructions,
                date: order.date,
                time: order.time
            })
        });
    } catch (e) {
        console.warn('Could not save to Sheets (network):', e);
        // Continue anyway ‚Äî WhatsApp will still notify owner
    }
    
    // Open WhatsApp for owner notification
    const msg = buildWhatsAppMsg(order);
    window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${msg}`, '_blank');
    
    // Clear cart
    cart = {};
    updateCartCount();
    
    // Show success screen
    showSuccessScreen(order);
}

function buildWhatsAppMsg(order) {
    const itemLines = order.items.replace(/, /g, '%0A‚Ä¢ ');
    return `üÜï *NEW ORDER ‚Äî ${CONFIG.BUSINESS_NAME}*%0A` +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ%0A%0A` +
        `üìã *Order ID:* ${order.orderId}%0A` +
        `üìÖ *Date/Time:* ${order.timestamp}%0A%0A` +
        `üë§ *Customer:* ${order.name}%0A` +
        `üì± *Phone:* ${order.phone}%0A` +
        `üìç *Location:* ${order.location}%0A` +
        `üçΩÔ∏è *Type:* ${order.type}%0A%0A` +
        `üõí *ITEMS:*%0A‚Ä¢ ${itemLines}%0A%0A` +
        `üí∞ *Total:* ‚Çπ${order.total}%0A` +
        `üí≥ *Payment:* ${order.payment}%0A` +
        (order.instructions ? `üìù *Instructions:* ${order.instructions}%0A` : '') +
        `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ%0A` +
        `‚è≥ *Status:* PENDING`;
}

function showSuccessScreen(order) {
    document.getElementById('checkoutBody').innerHTML = `
        <div class="success-box">
            <div class="success-icon">‚úì</div>
            <h2 style="color:var(--secondary); margin-bottom:0.5rem; font-size:1.75rem;">Order Placed!</h2>
            <p style="color:var(--text-light); margin-bottom:1.5rem;">Thank you, ${order.name}! üéâ</p>
            
            <div class="order-id-box">
                <div class="order-id-label">Your Order ID</div>
                <div class="order-id-value">${order.orderId}</div>
            </div>
            
            <p style="color:var(--text-light); margin-bottom:1.5rem; font-size:0.95rem;">
                ${order.type === 'Dine In'
                    ? `üçΩÔ∏è Your food will be served at <strong>${order.location}</strong>`
                    : `üõçÔ∏è Please collect from <strong>Pickup Counter</strong> when ready`}
            </p>
            
            <p style="color:var(--text-light); font-size:0.85rem; margin-bottom:1.5rem;">
                üì± WhatsApp opened to notify the owner. Please send the message if it didn't send automatically.
            </p>
            
            <button class="checkout-btn" onclick="closeCheckout()">Continue Shopping üõí</button>
        </div>
    `;
}

// ==========================================
// ADMIN
// ==========================================
window.showLogin = () => { document.getElementById('loginModal').classList.add('active'); };
window.closeLogin = () => { document.getElementById('loginModal').classList.remove('active'); };

window.doLogin = () => {
    const pass = document.getElementById('loginPass').value;
    if (pass === CONFIG.ADMIN_PASSWORD) {
        closeLogin();
        showAdmin();
    } else {
        alert('‚ùå Wrong password!');
        document.getElementById('loginPass').value = '';
    }
};

function showAdmin() {
    document.getElementById('customerView').style.display = 'none';
    document.querySelector('.fab').style.display = 'none';
    document.getElementById('adminView').classList.add('active');
    loadAdminOrders();
}

window.logout = () => {
    document.getElementById('adminView').classList.remove('active');
    document.getElementById('customerView').style.display = 'block';
    document.querySelector('.fab').style.display = 'flex';
    adminOrders = [];
};

window.loadAdminOrders = async () => {
    document.getElementById('ordersGrid').innerHTML = `
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading orders from Google Sheets...</p>
        </div>
    `;
    document.getElementById('statsGrid').innerHTML = '';
    
    try {
        const res = await fetch(CONFIG.APPS_SCRIPT_URL);
        const data = await res.json();
        adminOrders = data.orders || [];
        renderAdmin();
    } catch (e) {
        console.error('Failed to load orders:', e);
        document.getElementById('ordersGrid').innerHTML = `
            <div style="text-align:center; padding:2rem; color:var(--text-light);">
                <p>‚ö†Ô∏è Failed to load orders from Google Sheets.</p>
                <p style="font-size:0.875rem; margin-top:0.5rem;">Check your Apps Script deployment or network connection.</p>
                <button onclick="loadAdminOrders()" class="checkout-btn" style="margin-top:1rem; max-width:200px;">Try Again</button>
            </div>
        `;
    }
};

window.filterOrders = (status) => {
    currentFilter = status;
    document.querySelectorAll('#filterAll, #filterPENDING, #filterCONFIRMED, #filterCOMPLETED').forEach(b => b.classList.remove('active'));
    const el = document.getElementById(`filter${status === 'all' ? 'All' : status}`);
    if (el) el.classList.add('active');
    renderAdmin();
};

function renderAdmin() {
    // Stats
    const today = new Date().toDateString();
    const todayOrders = adminOrders.filter(o => {
        try { return new Date(o.timestamp).toDateString() === today; } catch(e) { return false; }
    });
    const pending = adminOrders.filter(o => (o.status || '').toUpperCase() === 'PENDING');
    const confirmed = adminOrders.filter(o => (o.status || '').toUpperCase() === 'CONFIRMED');
    const revenue = adminOrders.reduce((sum, o) => sum + (parseInt(o.total) || 0), 0);

    document.getElementById('statsGrid').innerHTML = `
        <div class="stat-box">
            <div class="stat-number">${adminOrders.length}</div>
            <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-box pending">
            <div class="stat-number" style="color:var(--accent);">${pending.length}</div>
            <div class="stat-label">Pending</div>
        </div>
        <div class="stat-box confirmed">
            <div class="stat-number" style="color:#3b82f6;">${confirmed.length}</div>
            <div class="stat-label">Confirmed</div>
        </div>
        <div class="stat-box revenue">
            <div class="stat-number" style="color:var(--secondary);">‚Çπ${revenue.toLocaleString('en-IN')}</div>
            <div class="stat-label">Total Revenue</div>
        </div>
    `;

    let filtered = adminOrders;
    if (currentFilter !== 'all') {
        filtered = adminOrders.filter(o => (o.status || '').toUpperCase() === currentFilter);
    }

    if (!filtered.length) {
        document.getElementById('ordersGrid').innerHTML = `
            <p style="text-align:center; color:var(--text-light); padding:2rem;">
                No orders found${currentFilter !== 'all' ? ` with status "${currentFilter}"` : ''}.
            </p>`;
        return;
    }

    document.getElementById('ordersGrid').innerHTML = filtered.map(order => {
        const status = (order.status || 'PENDING').toUpperCase();
        return `
        <div class="order-box ${status.toLowerCase()}">
            <div class="order-top">
                <div>
                    <div class="order-num">${order.orderId}</div>
                    <div class="order-time">üïê ${order.timestamp}</div>
                </div>
                <span class="status-badge status-${status.toLowerCase()}">${status}</span>
            </div>
            <div class="order-details">
                <div class="detail-row">
                    <span class="detail-label">Customer</span>
                    <span class="detail-value">${order.name || '‚Äî'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone</span>
                    <span class="detail-value">${order.phone || '‚Äî'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Location</span>
                    <span class="detail-value">${order.location || '‚Äî'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Type</span>
                    <span class="detail-value">${order.type || '‚Äî'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Payment</span>
                    <span class="detail-value">${order.payment || '‚Äî'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Total</span>
                    <span class="detail-value" style="color:var(--primary-dark); font-size:1.05rem; font-weight:800;">‚Çπ${order.total}</span>
                </div>
            </div>
            <div class="order-items">
                <strong>üõí Items:</strong> ${order.items || '‚Äî'}
            </div>
            ${order.instructions ? `<div class="order-instructions">üìù <strong>Instructions:</strong> ${order.instructions}</div>` : ''}
            <div class="order-actions">
                ${status === 'PENDING' ? `
                    <button class="action-btn btn-confirm" onclick="notifyAndUpdate('${order.orderId}','${order.phone}','CONFIRMED','confirmed')">‚úì Confirm</button>
                    <button class="action-btn btn-cancel" onclick="notifyAndUpdate('${order.orderId}','${order.phone}','CANCELLED','cancelled')">‚úó Cancel</button>
                    <button class="action-btn btn-whatsapp" onclick="notifyCustomer('${order.phone}','${order.orderId}','confirmed')">üì± Notify</button>
                ` : ''}
                ${status === 'CONFIRMED' ? `
                    <button class="action-btn btn-complete" onclick="notifyAndUpdate('${order.orderId}','${order.phone}','COMPLETED','ready')">‚úì Mark Complete</button>
                    <button class="action-btn btn-whatsapp" onclick="notifyCustomer('${order.phone}','${order.orderId}','ready')">üì± Order Ready</button>
                ` : ''}
            </div>
        </div>`;
    }).join('');
}

// NOTE: Status updates require Apps Script to support PATCH/update operations.
// For now, update in local state and notify via WhatsApp. Owner updates Sheet manually.
window.notifyAndUpdate = (orderId, phone, newStatus, msgType) => {
    // Update local state
    const order = adminOrders.find(o => o.orderId === orderId);
    if (order) {
        order.status = newStatus;
        renderAdmin();
        showNotification(`Order ${orderId} ‚Üí ${newStatus}`);
    }
    // Notify customer
    notifyCustomer(phone, orderId, msgType);
};

window.notifyCustomer = (phone, orderId, type) => {
    const msgs = {
        confirmed: `‚úÖ Hi! Your order *${orderId}* has been *CONFIRMED* and is being prepared. Thank you for choosing ${CONFIG.BUSINESS_NAME}! üçΩÔ∏è`,
        ready: `üéâ Your order *${orderId}* is *READY*! Please collect from the counter. Thank you! üôè`,
        cancelled: `‚ùå Sorry, your order *${orderId}* could not be processed. Please contact us for assistance. üôè`
    };
    const msg = encodeURIComponent(msgs[type] || msgs.confirmed);
    window.open(`https://wa.me/${phone.replace(/\D/g, '')}?text=${msg}`, '_blank');
};

// ==========================================
// UTILS
// ==========================================
function showNotification(text) {
    const notif = document.getElementById('notification');
    document.getElementById('notifText').textContent = text;
    notif.classList.add('show');
    setTimeout(() => notif.classList.remove('show'), 3500);
}

// Close modals on backdrop click
document.querySelectorAll('.modal-overlay').forEach(m => {
    m.addEventListener('click', (e) => { if (e.target === m) m.classList.remove('active'); });
});
document.getElementById('loginModal').addEventListener('click', (e) => {
    if (e.target === document.getElementById('loginModal')) closeLogin();
});
</script>
</body>
</html>
