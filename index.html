<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saummya's Nest</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #f59e0b;
            --primary-dark: #d97706;
            --primary-light: #fbbf24;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --accent: #ef4444;
            --bg: #fefce8;
            --surface: #ffffff;
            --text: #1f2937;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        h1, h2, h3, .brand { font-family: 'Poppins', sans-serif; }

        /* Loader */
        .loader {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--primary-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.75rem;
            font-weight: 800;
        }

        .header-btns {
            display: flex;
            gap: 0.75rem;
        }

        .btn-icon {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .btn-icon:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Banner Slider */
        .banner-container {
            margin: 1.5rem;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            position: relative;
            height: 280px;
        }

        .banner-slide {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.6s ease;
            display: flex;
            align-items: flex-end;
        }

        .banner-slide.active { opacity: 1; }

        .banner-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%);
        }

        .banner-content {
            position: relative;
            z-index: 2;
            padding: 2rem;
            color: white;
            width: 100%;
        }

        .banner-tag {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .banner-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .banner-desc {
            font-size: 1.1rem;
            opacity: 0.95;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .banner-dots {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 3;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .dot.active {
            background: white;
            width: 30px;
            border-radius: 5px;
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            overflow-x: auto;
            position: sticky;
            top: 70px;
            background: var(--bg);
            z-index: 50;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar { display: none; }

        .category-pill {
            white-space: nowrap;
            padding: 0.875rem 1.75rem;
            background: white;
            border: 2px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }

        .category-pill:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .category-pill.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Menu */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 2rem 0 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .menu-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .menu-card.unavailable {
            opacity: 0.65;
            filter: grayscale(0.4);
        }

        .card-image {
            height: 200px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            position: relative;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .menu-card:hover .card-image img {
            transform: scale(1.08);
        }

        .badges {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .badge {
            padding: 0.375rem 0.875rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .badge-new { background: var(--secondary); color: white; }
        .badge-sale { background: var(--accent); color: white; }
        .badge-hot { background: #f97316; color: white; }
        .badge-best { background: #8b5cf6; color: white; }

        .out-of-stock {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .item-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            flex: 1;
        }

        .item-desc {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .combo-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            margin-bottom: 1rem;
            border-left: 3px solid var(--primary);
        }

        .price-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .price-main {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
        }

        .price-old {
            font-size: 1.125rem;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .save-badge {
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.625rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .savings-bar {
            background: linear-gradient(90deg, var(--secondary), var(--secondary-dark));
            color: white;
            padding: 0.625rem;
            border-radius: 10px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .card-actions {
            display: flex;
            gap: 0.75rem;
        }

        .qty-stepper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg);
            padding: 0.375rem;
            border-radius: 12px;
        }

        .stepper-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.25rem;
            font-weight: 700;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stepper-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .stepper-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        .qty-value {
            min-width: 40px;
            text-align: center;
            font-weight: 700;
            font-size: 1.125rem;
        }

        .add-cart-btn {
            flex: 1;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.875rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-cart-btn:hover:not(:disabled) {
            background: var(--secondary-dark);
            transform: scale(1.02);
        }

        .add-cart-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        /* Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: white;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            border-radius: 30px 30px 0 0;
            overflow: hidden;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 70vh;
        }

        /* Cart Items */
        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 16px;
            margin-bottom: 1rem;
        }

        .cart-item-img {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            background: #e5e7eb;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qty-btn-sm {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .remove-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: auto;
        }

        .cart-summary {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 1.5rem;
            border-radius: 20px;
            margin-top: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .summary-total {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            border-top: 2px solid var(--primary);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border: none;
            padding: 1.25rem;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        /* Checkout Form */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .form-label span {
            color: var(--accent);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-label {
            display: block;
            padding: 1.25rem;
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            font-weight: 600;
        }

        .radio-option input:checked + .radio-label {
            border-color: var(--primary);
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: var(--primary-dark);
        }

        .conditional-field {
            display: none;
            animation: fadeIn 0.3s;
        }

        .conditional-field.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .payment-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 2px solid var(--border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-card:hover {
            border-color: var(--primary-light);
        }

        .payment-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }

        .payment-icon {
            font-size: 2rem;
        }

        .payment-info {
            flex: 1;
        }

        .payment-title {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .payment-subtitle {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        /* Instructions */
        .instructions-box {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .instructions-title {
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instructions-list {
            list-style: none;
            counter-reset: steps;
        }

        .instructions-list li {
            counter-increment: steps;
            margin-bottom: 0.75rem;
            padding-left: 2.5rem;
            position: relative;
        }

        .instructions-list li::before {
            content: counter(steps);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .amount-display {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin: 1rem 0;
        }

        /* Success Screen */
        .success-box {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1.5rem;
            animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .order-id-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 1.5rem;
            border-radius: 20px;
            margin: 1.5rem 0;
            border: 2px solid var(--primary-light);
        }

        .order-id-label {
            color: var(--text-light);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .order-id-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-dark);
            font-family: 'Courier New', monospace;
        }

        /* Admin Panel */
        .admin-view { display: none; }
        .admin-view.active { display: block; }

        .admin-header {
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-box {
            background: white;
            padding: 1.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .stat-box.pending { border-left-color: var(--accent); }
        .stat-box.confirmed { border-left-color: #3b82f6; }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .orders-grid {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .order-box {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .order-box:hover {
            transform: translateX(4px);
        }

        .order-box.pending { border-left-color: var(--accent); }
        .order-box.confirmed { border-left-color: #3b82f6; }
        .order-box.completed { border-left-color: var(--secondary); }

        .order-top {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .order-num {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--primary-dark);
        }

        .order-time {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-pending { background: #fee2e2; color: var(--accent); }
        .status-confirmed { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: var(--secondary-dark); }

        .order-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 12px;
        }

        .detail-row {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .order-items {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .order-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-confirm {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
        }

        .btn-complete {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-cancel {
            background: #fee2e2;
            color: var(--accent);
        }

        .btn-whatsapp {
            background: #25d366;
            color: white;
        }

        /* Login Modal */
        .login-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active { display: flex; }

        .login-card {
            background: white;
            padding: 2.5rem;
            border-radius: 24px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .login-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
        }

        .login-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .login-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
        }

        /* Floating Cart */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 99;
            transition: all 0.3s;
        }

        .fab:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .fab-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--accent);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 700;
            border: 2px solid white;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            display: none;
            align-items: center;
            gap: 1rem;
            z-index: 3000;
            border-left: 4px solid var(--accent);
            animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.show { display: flex; }

        .notif-icon {
            font-size: 1.5rem;
        }

        .notif-text {
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .banner-container { height: 220px; margin: 1rem; }
            .banner-title { font-size: 1.5rem; }
            .menu-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .order-details { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: var(--primary); font-weight: 600;">Loading from Google Sheets...</p>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span class="notif-icon">üîî</span>
        <span class="notif-text" id="notifText">New order received!</span>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-card">
            <h2 class="login-title">üîê Admin Login</h2>
            <input type="password" class="login-input" id="loginPass" placeholder="Enter password">
            <button class="login-btn" onclick="doLogin()">Login</button>
            <p style="text-align: center; margin-top: 1rem;">
                <a href="#" onclick="closeLogin()" style="color: var(--text-light);">Cancel</a>
            </p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="brand">
                <span>ü™∫</span>
                <span>Saummya's Nest</span>
            </div>
            <div class="header-btns">
                <button class="btn-icon" onclick="openCart()">
                    üõí <span id="headerCartCount">0</span>
                </button>
                <button class="btn-icon" onclick="showLogin()">
                    üîê Admin
                </button>
            </div>
        </div>
    </header>

    <!-- Customer View -->
    <div class="customer-view" id="customerView">
        <!-- Banner -->
        <div class="banner-container" id="bannerContainer"></div>

        <!-- Categories -->
        <div class="categories" id="categories"></div>

        <!-- Menu -->
        <div class="container" id="menuSection"></div>
    </div>

    <!-- Admin View -->
    <div class="admin-view" id="adminView">
        <div class="container">
            <div class="admin-header">
                <h2>üìä Dashboard Overview</h2>
                <p style="color: var(--text-light); margin-top: 0.5rem;">Manage orders and track performance</p>
            </div>

            <div class="stats-grid" id="statsGrid"></div>

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Recent Orders</h3>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="filterOrders('all')" class="category-pill active" id="filterAll">All</button>
                    <button onclick="filterOrders('pending')" class="category-pill" id="filterPending">Pending</button>
                    <button onclick="filterOrders('confirmed')" class="category-pill" id="filterConfirmed">Confirmed</button>
                </div>
            </div>

            <div class="orders-grid" id="ordersGrid"></div>

            <button class="checkout-btn" onclick="logout()" style="margin-top: 2rem;">Logout</button>
        </div>
    </div>

    <!-- Cart Modal -->
    <div class="modal-overlay" id="cartModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üõí Your Cart</span>
                <button class="close-btn" onclick="closeCart()">√ó</button>
            </div>
            <div class="modal-body" id="cartBody"></div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="checkoutTitle">üìã Checkout</span>
                <button class="close-btn" onclick="closeCheckout()">√ó</button>
            </div>
            <div class="modal-body" id="checkoutBody"></div>
        </div>
    </div>

    <!-- Floating Cart -->
    <div class="fab" onclick="openCart()">
        üõí
        <span class="fab-count" id="fabCount">0</span>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const CONFIG = {
            BUSINESS_NAME: "Saummya's Nest",
            WHATSAPP_NUMBER: "917363039591",
            UPI_ID: "8617322648@axl",
            ADMIN_PASSWORD: "nest2026",
            TOTAL_TABLES: 10,
            ENABLE_SOUND: true,
            
            // YOUR GOOGLE SHEET URL
            SHEET_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQDWtew0ZASIILQsfOGqDnW3Zflj19XEkuFD_S7cmw72Bz05R0a-GWw-kdQ7WPuCe2kp3khK4iSJjIy/pub?output=csv'
        };

        // ==========================================
        // DATA & STATE
        // ==========================================
        let menuData = [];
        let banners = [];
        let cart = {};
        let quantities = {};
        let orders = JSON.parse(localStorage.getItem('sn_orders') || '[]');
        let orderCounter = parseInt(localStorage.getItem('sn_orderCounter') || '1000');
        let currentFilter = 'all';
        let audioCtx = null;
        let lastOrderCount = orders.length;

        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.addEventListener('load', init);

        async function init() {
            try {
                await loadFromSheets();
                renderAll();
                hideLoader();
                // Start checking for new orders immediately
                startOrderCheck();
            } catch (e) {
                console.error('Failed to load:', e);
                showError();
            }
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
        }

        function showError() {
            document.getElementById('loader').innerHTML = `
                <p style="color: var(--accent); font-size: 1.2rem;">‚ö†Ô∏è Failed to load menu</p>
                <p style="margin: 1rem 0;">Please check your Google Sheet URL</p>
                <button onclick="location.reload()" style="padding: 1rem 2rem; background: var(--primary); color: white; border: none; border-radius: 12px; cursor: pointer;">Retry</button>
            `;
        }

        // ==========================================
        // GOOGLE SHEETS LOADER
        // ==========================================
        async function loadFromSheets() {
            const response = await fetch(CONFIG.SHEET_URL);
            const csv = await response.text();
            const lines = csv.split('\n').filter(l => l.trim());
            
            menuData = [];
            banners = [];
            
            for (let i = 1; i < lines.length; i++) {
                const row = parseCSV(lines[i]);
                const type = row[0];
                
                if (type === 'Banner') {
                    banners.push({
                        title: row[1],
                        description: row[2],
                        image: row[3],
                        active: row[4]?.toLowerCase() === 'yes'
                    });
                } else if (type === 'Item' || type === 'Combo') {
                    const item = {
                        id: `item-${i}`,
                        type,
                        name: row[1],
                        category: row[2] || 'Other',
                        price: parseInt(row[3]) || 0,
                        oldPrice: parseInt(row[4]) || 0,
                        description: row[5] || '',
                        image: row[6] || '',
                        tags: row[7] ? row[7].split(',').map(t => t.trim()) : [],
                        comboItems: row[8] || '',
                        available: row[9]?.toLowerCase() === 'yes'
                    };
                    menuData.push(item);
                    quantities[item.id] = 0;
                }
            }
        }

        function parseCSV(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    if (inQuotes && line[i+1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result.map(v => v.replace(/^"|"$/g, ''));
        }

        // ==========================================
        // RENDERING
        // ==========================================
        function renderAll() {
            renderBanners();
            renderCategories();
            renderMenu();
        }

        function renderBanners() {
            const active = banners.filter(b => b.active);
            const container = document.getElementById('bannerContainer');
            
            if (!active.length) {
                container.style.display = 'none';
                return;
            }
            
            container.innerHTML = active.map((b, i) => `
                <div class="banner-slide ${i === 0 ? 'active' : ''}" style="background-image: url('${b.image}')">
                    <div class="banner-overlay"></div>
                    <div class="banner-content">
                        ${b.tag ? `<span class="banner-tag">${b.tag}</span>` : ''}
                        <h2 class="banner-title">${b.title}</h2>
                        <p class="banner-desc">${b.description}</p>
                    </div>
                </div>
            `).join('') + `
                <div class="banner-dots">
                    ${active.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" onclick="goToBanner(${i})"></div>`).join('')}
                </div>
            `;
            
            // Auto-rotate
            if (active.length > 1) {
                let current = 0;
                setInterval(() => {
                    document.querySelectorAll('.banner-slide').forEach((s, i) => {
                        s.classList.toggle('active', i === current);
                    });
                    document.querySelectorAll('.dot').forEach((d, i) => {
                        d.classList.toggle('active', i === current);
                    });
                    current = (current + 1) % active.length;
                }, 5000);
            }
        }

        window.goToBanner = (index) => {
            document.querySelectorAll('.banner-slide').forEach((s, i) => {
                s.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.dot').forEach((d, i) => {
                d.classList.toggle('active', i === index);
            });
        };

        function renderCategories() {
            const cats = [...new Set(menuData.map(i => i.category))];
            const emojis = { 'Beverages': '‚òï', 'Starters': 'ü•ò', 'Main Course': 'üçõ', 'Desserts': 'üç∞', 'Combos': 'üéÅ', 'Breakfast': 'üç≥', 'Snacks': 'üçø' };
            
            document.getElementById('categories').innerHTML = cats.map((c, i) => `
                <button class="category-pill ${i === 0 ? 'active' : ''}" onclick="setCategory('${c}', this)">
                    ${emojis[c] || 'üçΩÔ∏è'} ${c}
                </button>
            `).join('');
        }

        window.setCategory = (cat, btn) => {
            document.querySelectorAll('.category-pill').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMenu(cat);
        };

        function renderMenu(filterCat = null) {
            const cats = filterCat ? [filterCat] : [...new Set(menuData.map(i => i.category))];
            
            document.getElementById('menuSection').innerHTML = cats.map(cat => {
                const items = menuData.filter(i => i.category === cat);
                return `
                    <h2 class="section-title">${cat}</h2>
                    <div class="menu-grid">
                        ${items.map(item => renderItem(item)).join('')}
                    </div>
                `;
            }).join('');
        }

        function renderItem(item) {
            const discount = item.oldPrice ? Math.round((1 - item.price/item.oldPrice) * 100) : 0;
            const unavailable = !item.available;
            
            return `
                <div class="menu-card ${unavailable ? 'unavailable' : ''}">
                    <div class="card-image">
                        ${item.image ? `<img src="${item.image}" alt="${item.name}" loading="lazy">` : ''}
                        <div class="badges">
                            ${item.tags.map(tag => {
                                let cls = 'badge-sale';
                                if (tag.toLowerCase().includes('new')) cls = 'badge-new';
                                else if (tag.toLowerCase().includes('hot')) cls = 'badge-hot';
                                else if (tag.toLowerCase().includes('best')) cls = 'badge-best';
                                return `<span class="badge ${cls}">${tag}</span>`;
                            }).join('')}
                        </div>
                        ${unavailable ? '<div class="out-of-stock">Out of Stock</div>' : ''}
                    </div>
                    <div class="card-body">
                        <div class="item-header">
                            <h3 class="item-name">${item.name}</h3>
                        </div>
                        <p class="item-desc">${item.description}</p>
                        ${item.comboItems ? `<div class="combo-box">üéÅ <strong>Includes:</strong> ${item.comboItems}</div>` : ''}
                        <div class="price-row">
                            <span class="price-main">‚Çπ${item.price}</span>
                            ${item.oldPrice ? `<span class="price-old">‚Çπ${item.oldPrice}</span>` : ''}
                            ${discount > 0 ? `<span class="save-badge">Save ${discount}%</span>` : ''}
                        </div>
                        ${item.oldPrice ? `<div class="savings-bar">üí∞ You save ‚Çπ${item.oldPrice - item.price}!</div>` : ''}
                        <div class="card-actions">
                            <div class="qty-stepper">
                                <button class="stepper-btn" onclick="changeQty('${item.id}', -1)" ${unavailable ? 'disabled' : ''}>‚àí</button>
                                <span class="qty-value" id="qty-${item.id}">0</span>
                                <button class="stepper-btn" onclick="changeQty('${item.id}', 1)" ${unavailable ? 'disabled' : ''}>+</button>
                            </div>
                            <button class="add-cart-btn" onclick="addToCart('${item.id}')" ${unavailable ? 'disabled' : ''}>
                                ${unavailable ? '‚ùå Unavailable' : 'üõí Add'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==========================================
        // CART FUNCTIONS
        // ==========================================
        window.changeQty = (id, delta) => {
            quantities[id] = Math.max(0, (quantities[id] || 0) + delta);
            const el = document.getElementById(`qty-${id}`);
            if (el) el.textContent = quantities[id];
        };

        window.addToCart = (id) => {
            const qty = quantities[id];
            if (!qty) return alert('Please select quantity first');
            
            const item = menuData.find(i => i.id === id);
            if (!item?.available) return;
            
            if (cart[id]) cart[id].qty += qty;
            else cart[id] = { ...item, qty };
            
            quantities[id] = 0;
            const el = document.getElementById(`qty-${id}`);
            if (el) el.textContent = '0';
            
            updateCartCount();
            
            // Animation feedback
            const btn = event.target;
            btn.innerHTML = '‚úì Added!';
            btn.style.background = 'var(--secondary)';
            setTimeout(() => {
                btn.innerHTML = 'üõí Add';
                btn.style.background = '';
            }, 1000);
        };

        function updateCartCount() {
            const count = Object.values(cart).reduce((sum, i) => sum + i.qty, 0);
            document.getElementById('headerCartCount').textContent = count;
            document.getElementById('fabCount').textContent = count;
        }

        window.openCart = () => {
            renderCart();
            document.getElementById('cartModal').classList.add('active');
        };

        window.closeCart = () => {
            document.getElementById('cartModal').classList.remove('active');
        };

        function renderCart() {
            const items = Object.values(cart);
            const body = document.getElementById('cartBody');
            
            if (!items.length) {
                body.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-light);"><div style="font-size: 4rem; margin-bottom: 1rem;">üõí</div><p>Your cart is empty</p><p style="font-size: 0.9rem; margin-top: 0.5rem;">Add some delicious items!</p></div>';
                return;
            }
            
            const total = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            body.innerHTML = `
                <div>
                    ${items.map(item => `
                        <div class="cart-item">
                            <img src="${item.image || ''}" class="cart-item-img" onerror="this.style.display='none'">
                            <div class="cart-item-info">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">‚Çπ${item.price} each</div>
                                <div class="cart-item-qty">
                                    <button class="qty-btn-sm" onclick="updateCartQty('${item.id}', -1)">‚àí</button>
                                    <span style="font-weight: 700; min-width: 30px; text-align: center;">${item.qty}</span>
                                    <button class="qty-btn-sm" onclick="updateCartQty('${item.id}', 1)">+</button>
                                </div>
                            </div>
                            <div style="font-weight: 800; font-size: 1.125rem;">‚Çπ${item.price * item.qty}</div>
                            <button class="remove-btn" onclick="removeCartItem('${item.id}')">üóë</button>
                        </div>
                    `).join('')}
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>‚Çπ${total}</span>
                    </div>
                    <div class="summary-row">
                        <span>Taxes</span>
                        <span>Included</span>
                    </div>
                    <div class="summary-row summary-total">
                        <span>Total</span>
                        <span>‚Çπ${total}</span>
                    </div>
                    <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout ‚Üí</button>
                </div>
            `;
        }

        window.updateCartQty = (id, delta) => {
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            updateCartCount();
            renderCart();
        };

        window.removeCartItem = (id) => {
            delete cart[id];
            updateCartCount();
            renderCart();
        };

        // ==========================================
        // CHECKOUT - FIXED UPI ‚Üí WHATSAPP FLOW
        // ==========================================
        window.openCheckout = () => {
            closeCart();
            const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            document.getElementById('checkoutBody').innerHTML = `
                <form onsubmit="processCheckout(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name <span>*</span></label>
                        <input type="text" class="form-input" id="custName" required placeholder="Enter your name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number <span>*</span></label>
                        <input type="tel" class="form-input" id="custPhone" required placeholder="+91 98765 43210">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Order Type <span>*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="orderType" value="dine-in" id="typeDine" checked onchange="toggleTable()">
                                <label class="radio-label" for="typeDine">üçΩÔ∏è Dine In</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="orderType" value="pickup" id="typePickup" onchange="toggleTable()">
                                <label class="radio-label" for="typePickup">üõçÔ∏è Pickup</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="conditional-field active" id="tableSection">
                        <label class="form-label">Table Number <span>*</span></label>
                        <select class="form-select" id="tableNum">
                            ${Array.from({length: CONFIG.TOTAL_TABLES}, (_, i) => 
                                `<option value="${i+1}">Table ${i+1}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method <span>*</span></label>
                        <div class="payment-options">
                            <div class="payment-card selected" onclick="selectPayment(this, 'counter')" id="payCounter">
                                <span class="payment-icon">üíµ</span>
                                <div class="payment-info">
                                    <div class="payment-title">Pay at Counter</div>
                                    <div class="payment-subtitle">Cash, Card, or UPI at cafe</div>
                                </div>
                            </div>
                            <div class="payment-card" onclick="selectPayment(this, 'upi')" id="payUPI">
                                <span class="payment-icon">üì±</span>
                                <div class="payment-info">
                                    <div class="payment-title">Pay Now via UPI</div>
                                    <div class="payment-subtitle">Google Pay, PhonePe, Paytm</div>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="paymentMethod" value="counter">
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 1.25rem; border-radius: 16px; margin: 1.5rem 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Total Amount</span>
                            <span style="font-size: 1.75rem; font-weight: 800; color: var(--primary);">‚Çπ${total}</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="checkout-btn">Place Order</button>
                </form>
            `;
            
            document.getElementById('checkoutModal').classList.add('active');
        };

        window.closeCheckout = () => {
            document.getElementById('checkoutModal').classList.remove('active');
        };

        window.toggleTable = () => {
            const isDine = document.getElementById('typeDine').checked;
            document.getElementById('tableSection').classList.toggle('active', isDine);
        };

        window.selectPayment = (el, method) => {
            document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('paymentMethod').value = method;
        };

        window.processCheckout = (e) => {
            e.preventDefault();
            
            const name = document.getElementById('custName').value;
            const phone = document.getElementById('custPhone').value;
            const type = document.querySelector('input[name="orderType"]:checked').value;
            const payment = document.getElementById('paymentMethod').value;
            const table = document.getElementById('tableNum')?.value;
            const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            // Generate serial order ID with timestamp
            orderCounter++;
            localStorage.setItem('sn_orderCounter', orderCounter);
            const timestamp = new Date();
            const dateStr = timestamp.toISOString().slice(0,10).replace(/-/g,'');
            const timeStr = timestamp.toTimeString().slice(0,5).replace(':','');
            const orderId = `SN${dateStr}-${orderCounter}`;
            
            const order = {
                orderId,
                timestamp: timestamp.toLocaleString('en-IN'),
                date: dateStr,
                time: timeStr,
                name,
                phone,
                items: Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(', '),
                total,
                type: type === 'dine-in' ? 'Dine In' : 'Pickup',
                location: type === 'dine-in' ? `Table ${table}` : 'Pickup Counter',
                payment: payment === 'upi' ? 'UPI (Pending)' : 'Pay at Counter',
                status: 'PENDING'
            };
            
            if (payment === 'upi') {
                showUPIInstructions(order, total);
            } else {
                completeOrder(order);
            }
        };

        function showUPIInstructions(order, amount) {
            const upiLink = `upi://pay?pa=${CONFIG.UPI_ID}&pn=${encodeURIComponent(CONFIG.BUSINESS_NAME)}&am=${amount}&cu=INR&tn=Order_${order.orderId}`;
            
            document.getElementById('checkoutBody').innerHTML = `
                <div class="instructions-box">
                    <div class="instructions-title">üì± UPI Payment Steps</div>
                    <ol class="instructions-list">
                        <li>Click "Open UPI App" below - your UPI app will open</li>
                        <li>Complete the payment of <strong>‚Çπ${amount}</strong></li>
                        <li>After payment, return here and click "Payment Done"</li>
                        <li>WhatsApp will open - send the confirmation message</li>
                    </ol>
                </div>
                
                <div class="amount-display">‚Çπ${amount}</div>
                
                <button onclick="openUPILink('${upiLink}', '${order.orderId}', ${amount})" class="checkout-btn" style="margin-bottom: 1rem;">
                    Open UPI App
                </button>
                
                <button class="checkout-btn" onclick="completeOrderAfterUPI('${order.orderId}')" style="background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));">
                    ‚úÖ Payment Done - Confirm Order
                </button>
                
                <button onclick="backToCheckout()" style="width: 100%; padding: 1rem; background: #f3f4f6; border: none; border-radius: 12px; margin-top: 1rem; cursor: pointer;">
                    ‚Üê Back
                </button>
            `;
        }

        // FIXED: Open UPI in new way that allows returning to page
        window.openUPILink = (link, orderId, amount) => {
            // Try to open UPI app
            window.location.href = link;
            
            // Also store order data in case user returns
            const pendingOrder = {
                orderId,
                amount,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('sn_pendingUPI', JSON.stringify(pendingOrder));
        };

        window.backToCheckout = () => {
            openCheckout();
        };

        window.completeOrderAfterUPI = (orderId) => {
            // Find order in orders array
            let order = orders.find(o => o.orderId === orderId);
            
            // If not found (page was refreshed), create from pending or cart
            if (!order) {
                const pending = JSON.parse(localStorage.getItem('sn_pendingUPI') || '{}');
                if (pending.orderId === orderId) {
                    // Recreate order from cart data if available
                    const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
                    const name = document.getElementById('custName')?.value || 'Customer';
                    const phone = document.getElementById('custPhone')?.value || '';
                    const type = document.querySelector('input[name="orderType"]:checked')?.value || 'dine-in';
                    const table = document.getElementById('tableNum')?.value || '1';
                    
                    order = {
                        orderId,
                        timestamp: new Date().toLocaleString('en-IN'),
                        date: new Date().toISOString().slice(0,10).replace(/-/g,''),
                        time: new Date().toTimeString().slice(0,5).replace(':',''),
                        name,
                        phone,
                        items: Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(', '),
                        total: pending.amount || total,
                        type: type === 'dine-in' ? 'Dine In' : 'Pickup',
                        location: type === 'dine-in' ? `Table ${table}` : 'Pickup Counter',
                        payment: 'UPI (Paid)',
                        status: 'PENDING'
                    };
                }
            }
            
            if (order) {
                order.payment = 'UPI (Paid)';
                // Save to orders if not already there
                if (!orders.find(o => o.orderId === orderId)) {
                    orders.unshift(order);
                    localStorage.setItem('sn_orders', JSON.stringify(orders));
                } else {
                    localStorage.setItem('sn_orders', JSON.stringify(orders));
                }
                // Clear pending
                localStorage.removeItem('sn_pendingUPI');
                completeOrder(order);
            } else {
                alert('Order not found. Please try again or contact staff.');
            }
        };

        function completeOrder(order) {
            // Save order if not already saved
            if (!orders.find(o => o.orderId === order.orderId)) {
                orders.unshift(order);
                localStorage.setItem('sn_orders', JSON.stringify(orders));
            }
            
            // WhatsApp message with emojis
            const msg = `üÜï *NEW ORDER - ${CONFIG.BUSINESS_NAME}*%0A` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ%0A%0A` +
                       `üìã *Order ID:* ${order.orderId}%0A` +
                       `üìÖ *Date:* ${order.timestamp}%0A%0A` +
                       `üë§ *Customer:* ${order.name}%0A` +
                       `üì± *Phone:* ${order.phone}%0A` +
                       `üìç *Location:* ${order.location}%0A` +
                       `üçΩÔ∏è *Type:* ${order.type}%0A%0A` +
                       `üõí *ITEMS:*%0A${order.items.replace(/, /g, '%0A')}%0A%0A` +
                       `üí∞ *Total:* ‚Çπ${order.total}%0A` +
                       `üí≥ *Payment:* ${order.payment}%0A` +
                       `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ%0A` +
                       `‚è≥ *Status:* PENDING%0A%0A` +
                       `üëâ Tap to confirm order`;
            
            // FIXED: Use window.open with _blank to ensure it opens
            const whatsappWindow = window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${msg}`, '_blank');
            
            // If popup blocked, show manual button
            if (!whatsappWindow || whatsappWindow.closed || typeof whatsappWindow.closed === 'undefined') {
                document.getElementById('checkoutBody').innerHTML += `
                    <div style="margin-top: 1rem; padding: 1rem; background: #fef3c7; border-radius: 12px; text-align: center;">
                        <p>Popup blocked! Click below to open WhatsApp:</p>
                        <a href="https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${msg}" target="_blank" class="checkout-btn" style="display: inline-block; text-decoration: none; margin-top: 0.5rem;">
                            Open WhatsApp
                        </a>
                    </div>
                `;
            }
            
            // Clear cart
            cart = {};
            updateCartCount();
            
            // Show success
            document.getElementById('checkoutBody').innerHTML = `
                <div class="success-box">
                    <div class="success-icon">‚úì</div>
                    <h2 style="color: var(--secondary); margin-bottom: 0.5rem;">Order Placed!</h2>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">Thank you for your order</p>
                    
                    <div class="order-id-box">
                        <div class="order-id-label">Your Order ID</div>
                        <div class="order-id-value">${order.orderId}</div>
                    </div>
                    
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                        ${order.type === 'Dine In' 
                            ? `üçΩÔ∏è Your food will be served at ${order.location}` 
                            : `üõçÔ∏è Please collect from ${order.location} when ready`}
                    </p>
                    
                    <button class="checkout-btn" onclick="closeCheckout()">Continue Shopping</button>
                </div>
            `;
        }

        // ==========================================
        // ADMIN PANEL - FIXED AUTO-UPDATE
        // ==========================================
        window.showLogin = () => {
            document.getElementById('loginModal').classList.add('active');
        };

        window.closeLogin = () => {
            document.getElementById('loginModal').classList.remove('active');
        };

        window.doLogin = () => {
            const pass = document.getElementById('loginPass').value;
            if (pass === CONFIG.ADMIN_PASSWORD) {
                closeLogin();
                showAdmin();
            } else {
                alert('‚ùå Wrong password!');
            }
        };

        function showAdmin() {
            document.getElementById('customerView').style.display = 'none';
            document.querySelector('.fab').style.display = 'none';
            document.getElementById('adminView').classList.add('active');
            // FIXED: Force refresh of data when showing admin
            refreshOrdersData();
            renderAdmin();
        }

        // FIXED: Refresh orders from localStorage to get latest
        function refreshOrdersData() {
            orders = JSON.parse(localStorage.getItem('sn_orders') || '[]');
            lastOrderCount = orders.length;
        }

        window.logout = () => {
            document.getElementById('adminView').classList.remove('active');
            document.getElementById('customerView').style.display = 'block';
            document.querySelector('.fab').style.display = 'flex';
        };

        window.filterOrders = (status) => {
            currentFilter = status;
            document.querySelectorAll('#filterAll, #filterPending, #filterConfirmed').forEach(b => b.classList.remove('active'));
            document.getElementById(`filter${status.charAt(0).toUpperCase() + status.slice(1)}`).classList.add('active');
            // FIXED: Refresh data before filtering
            refreshOrdersData();
            renderAdmin();
        };

        function renderAdmin() {
            // FIXED: Always get fresh data
            refreshOrdersData();
            
            const today = new Date().toDateString();
            const todayOrders = orders.filter(o => new Date(o.timestamp).toDateString() === today);
            const pending = orders.filter(o => o.status === 'PENDING');
            const confirmed = orders.filter(o => o.status === 'CONFIRMED');
            const revenue = todayOrders.reduce((sum, o) => sum + parseInt(o.total), 0);

            // FIXED: Update stats grid with fresh data
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-box">
                    <div class="stat-number">${todayOrders.length}</div>
                    <div class="stat-label">Today's Orders</div>
                </div>
                <div class="stat-box pending">
                    <div class="stat-number" style="color: var(--accent);">${pending.length}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-box confirmed">
                    <div class="stat-number" style="color: #3b82f6;">${confirmed.length}</div>
                    <div class="stat-label">Confirmed</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">‚Çπ${revenue}</div>
                    <div class="stat-label">Revenue Today</div>
                </div>
            `;

            let filtered = orders;
            if (currentFilter !== 'all') {
                filtered = orders.filter(o => o.status.toLowerCase() === currentFilter);
            }

            document.getElementById('ordersGrid').innerHTML = filtered.length ? filtered.map(order => `
                <div class="order-box ${order.status.toLowerCase()}">
                    <div class="order-top">
                        <div>
                            <div class="order-num">#${order.orderId}</div>
                            <div class="order-time">üïê ${order.timestamp}</div>
                        </div>
                        <span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span>
                    </div>
                    <div class="order-details">
                        <div class="detail-row">
                            <span class="detail-label">Customer</span>
                            <span class="detail-value">${order.name}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone</span>
                            <span class="detail-value">${order.phone}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Location</span>
                            <span class="detail-value">${order.location}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Type</span>
                            <span class="detail-value">${order.type}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Payment</span>
                            <span class="detail-value">${order.payment}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Total</span>
                            <span class="detail-value" style="color: var(--primary); font-size: 1.125rem;">‚Çπ${order.total}</span>
                        </div>
                    </div>
                    <div class="order-items">
                        <strong>üõí Items:</strong> ${order.items}
                    </div>
                    <div class="order-actions">
                        ${order.status === 'PENDING' ? `
                            <button class="action-btn btn-confirm" onclick="updateStatus('${order.orderId}', 'CONFIRMED')">‚úì Confirm</button>
                            <button class="action-btn btn-whatsapp" onclick="notifyCustomer('${order.phone}', '${order.orderId}', 'confirmed')">üì± Notify Customer</button>
                            <button class="action-btn btn-cancel" onclick="updateStatus('${order.orderId}', 'CANCELLED')">‚úó Cancel</button>
                        ` : ''}
                        ${order.status === 'CONFIRMED' ? `
                            <button class="action-btn btn-complete" onclick="updateStatus('${order.orderId}', 'COMPLETED')">‚úì Complete</button>
                            <button class="action-btn btn-whatsapp" onclick="notifyCustomer('${order.phone}', '${order.orderId}', 'ready')">üì± Order Ready</button>
                        ` : ''}
                    </div>
                </div>
            `).join('') : '<p style="text-align: center; color: var(--text-light); padding: 2rem;">No orders found</p>';
        }

        window.updateStatus = (orderId, status) => {
            // FIXED: Refresh data before updating
            refreshOrdersData();
            const order = orders.find(o => o.orderId === orderId);
            if (order) {
                order.status = status;
                localStorage.setItem('sn_orders', JSON.stringify(orders));
                // FIXED: Update lastOrderCount to prevent false notifications
                lastOrderCount = orders.length;
                renderAdmin();
                showNotification(`Order ${orderId} ${status.toLowerCase()}`);
            }
        };

        window.notifyCustomer = (phone, orderId, type) => {
            const messages = {
                confirmed: `‚úÖ Hi! Your order *${orderId}* has been *CONFIRMED* and is being prepared. Thank you for choosing ${CONFIG.BUSINESS_NAME}! üçΩÔ∏è`,
                ready: `üéâ Great news! Your order *${orderId}* is *READY* for pickup/delivery. Please collect from the counter. Thank you! üôè`,
                cancelled: `‚ùå Sorry, your order *${orderId}* could not be processed. Please contact us for assistance.`
            };
            
            const msg = encodeURIComponent(messages[type] || messages.confirmed);
            window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');
        };

        // ==========================================
        // NOTIFICATIONS & SOUND
        // ==========================================
        function showNotification(text) {
            const notif = document.getElementById('notification');
            document.getElementById('notifText').textContent = text;
            notif.classList.add('show');
            playSound();
            setTimeout(() => notif.classList.remove('show'), 4000);
        }

        function playSound() {
            if (!CONFIG.ENABLE_SOUND) return;
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
            
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        // FIXED: Better order checking with proper data refresh
        function startOrderCheck() {
            // Check immediately and then every 2 seconds
            checkForNewOrders();
            setInterval(checkForNewOrders, 2000);
        }

        function checkForNewOrders() {
            // Only check if admin panel is active
            if (!document.getElementById('adminView').classList.contains('active')) return;
            
            // Get fresh data
            const currentOrders = JSON.parse(localStorage.getItem('sn_orders') || '[]');
            
            if (currentOrders.length > lastOrderCount) {
                // New order arrived
                orders = currentOrders;
                lastOrderCount = currentOrders.length;
                renderAdmin();
                showNotification('üÜï New order received!');
            } else if (currentOrders.length !== orders.length) {
                // Orders changed (status updates, etc)
                orders = currentOrders;
                lastOrderCount = currentOrders.length;
                renderAdmin();
            }
        }

        // Close modals on outside click
        document.querySelectorAll('.modal-overlay, .login-modal').forEach(m => {
            m.addEventListener('click', (e) => {
                if (e.target === m) m.classList.remove('active');
            });
        });
    </script>
</body>
</html>
