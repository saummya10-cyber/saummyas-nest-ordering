<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saummya's Nest - Order Online</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #D97706;
            --primary-dark: #B45309;
            --primary-light: #FCD34D;
            --secondary: #059669;
            --secondary-dark: #047857;
            --accent: #DC2626;
            --bg: #FFFBF5;
            --surface: #FFFFFF;
            --text: #1F2937;
            --text-light: #6B7280;
            --border: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Loading Screen */
        .loader-container {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid var(--primary-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon { font-size: 2rem; }
        
        .logo h1 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
        }

        /* Cart Button */
        .cart-btn {
            position: relative;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.75rem;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .cart-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
        
        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
        }

        /* Banner Slider */
        .banner-section {
            background: var(--surface);
            margin: 1rem;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .banner-slider {
            position: relative;
            height: 250px;
        }

        .banner-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 0.5s;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end;
            padding: 2rem;
        }

        .banner-slide.active { opacity: 1; }
        
        .banner-content {
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 2rem 1rem 1rem;
            width: 100%;
            border-radius: 0 0 20px 20px;
        }

        .banner-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        /* Category Navigation */
        .category-nav {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            overflow-x: auto;
            scrollbar-width: none;
            position: sticky;
            top: 70px;
            background: var(--bg);
            z-index: 50;
        }

        .category-nav::-webkit-scrollbar { display: none; }

        .category-pill {
            white-space: nowrap;
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-pill.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Menu Grid */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            margin: 2rem 0 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-dark);
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Menu Item Card */
        .menu-item {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .menu-item.unavailable { opacity: 0.6; filter: grayscale(0.5); }

        .item-image-container {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            overflow: hidden;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .menu-item:hover .item-image { transform: scale(1.1); }

        .item-badges {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-new { background: var(--secondary); color: white; }
        .badge-sale { background: var(--accent); color: white; }
        .badge-bestseller { background: gold; color: black; }

        .unavailable-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .item-content { padding: 1.5rem; }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .item-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
        }

        .item-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .combo-includes {
            background: var(--bg);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .combo-includes strong { color: var(--primary-dark); }

        .price-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .current-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .old-price {
            font-size: 1.1rem;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .discount-badge {
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .savings {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        /* Quantity Control */
        .item-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg);
            padding: 0.25rem;
            border-radius: 12px;
        }

        .qty-btn {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .qty-btn:hover { background: var(--primary-dark); transform: scale(1.1); }
        .qty-btn:disabled { background: var(--border); cursor: not-allowed; }

        .qty-display {
            min-width: 40px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .add-btn {
            flex: 1;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.875rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .add-btn:hover:not(:disabled) {
            background: var(--secondary-dark);
            transform: scale(1.02);
        }

        .add-btn:disabled { background: var(--border); cursor: not-allowed; }

        /* Cart Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            border-radius: 30px 30px 0 0;
            overflow: hidden;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-header {
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 { font-family: 'Playfair Display', serif; }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .close-btn:hover { background: rgba(255,255,255,0.2); }

        .modal-body { padding: 1.5rem; overflow-y: auto; max-height: 60vh; }

        .empty-cart {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-cart-icon { font-size: 4rem; margin-bottom: 1rem; }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .cart-item-img {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            background: var(--bg);
        }

        .cart-item-details { flex: 1; }

        .cart-item-name { font-weight: 700; margin-bottom: 0.25rem; }
        
        .cart-item-price { color: var(--primary); font-weight: 600; }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .cart-qty-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .remove-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
        }

        .cart-summary {
            background: var(--bg);
            padding: 1.5rem;
            border-top: 2px solid var(--border);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-row.total {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            border-top: 2px solid var(--primary);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            border: none;
            padding: 1.25rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 1rem;
            transition: transform 0.2s;
        }

        .checkout-btn:hover { transform: scale(1.02); }

        /* Checkout Form */
        .form-group { margin-bottom: 1.5rem; }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .required { color: var(--accent); }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217,119,6,0.1);
        }

        .radio-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .radio-option {
            position: relative;
        }

        .radio-option input {
            position: absolute;
            opacity: 0;
        }

        .radio-label {
            display: block;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .radio-option input:checked + .radio-label {
            border-color: var(--primary);
            background: rgba(217,119,6,0.1);
            color: var(--primary);
        }

        .conditional-fields {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: 12px;
        }

        .conditional-fields.active { display: block; }

        .payment-options { display: flex; flex-direction: column; gap: 1rem; }

        .payment-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-option:hover { border-color: var(--primary); }
        
        .payment-option.selected {
            border-color: var(--primary);
            background: rgba(217,119,6,0.05);
        }

        .payment-icon { font-size: 2rem; }
        
        .payment-title { font-weight: 700; }
        
        .payment-subtitle { font-size: 0.9rem; color: var(--text-light); }

        /* Success Screen */
        .success-screen {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 1.5rem;
            animation: scaleIn 0.5s;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .order-id-box {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 16px;
            margin: 1.5rem 0;
        }

        .order-id-label { color: var(--text-light); margin-bottom: 0.5rem; }
        
        .order-id {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            font-family: monospace;
        }

        /* Floating Cart (Mobile) */
        .floating-cart {
            display: none;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 64px;
            height: 64px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 99;
        }

        @media (max-width: 768px) {
            .cart-btn { display: none; }
            .floating-cart { display: flex; }
            .menu-grid { grid-template-columns: 1fr; }
            .banner-slider { height: 200px; }
        }

        /* UPI Instructions */
        .upi-steps {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 16px;
            margin: 1rem 0;
        }

        .upi-steps ol {
            margin-left: 1.5rem;
            line-height: 2;
        }

        .upi-steps li { margin-bottom: 0.5rem; }

        .upi-amount {
            text-align: center;
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin: 1rem 0;
        }

        /* Admin Link (Hidden) */
        .admin-link {
            position: fixed;
            bottom: 10px;
            left: 10px;
            opacity: 0.1;
            font-size: 0.75rem;
            color: var(--text-light);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
        <p style="margin-top: 1rem; color: var(--primary); font-weight: 600;">Loading Menu...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ü™∫</span>
                <h1>Saummya's Nest</h1>
            </div>
            <button class="cart-btn" onclick="openCart()">
                <span>üõí Cart</span>
                <span class="cart-count" id="cart-count">0</span>
            </button>
        </div>
    </header>

    <!-- Banner Section -->
    <section class="banner-section" id="banner-section" style="display: none;">
        <div class="banner-slider" id="banner-slider"></div>
    </section>

    <!-- Category Navigation -->
    <nav class="category-nav" id="category-nav"></nav>

    <!-- Menu Container -->
    <main class="container" id="menu-container"></main>

    <!-- Floating Cart Button -->
    <div class="floating-cart" onclick="openCart()">
        üõí
        <span class="cart-count" id="cart-count-mobile">0</span>
    </div>

    <!-- Cart Modal -->
    <div class="modal" id="cart-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Cart</h2>
                <button class="close-btn" onclick="closeCart()">√ó</button>
            </div>
            <div class="modal-body" id="cart-body"></div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Checkout</h2>
                <button class="close-btn" onclick="closeCheckout()">√ó</button>
            </div>
            <div class="modal-body" id="checkout-body"></div>
        </div>
    </div>

    <!-- Hidden Admin Link -->
    <a href="admin.html" class="admin-link">Admin</a>

    <script src="assets/js/config.js"></script>
    <script>
        // Global State
        let menuData = [];
        let cart = {};
        let quantities = {};
        let banners = [];
        let currentBanner = 0;

        // Initialize
        window.addEventListener('load', init);

        async function init() {
            try {
                await loadData();
                renderBanners();
                renderCategories();
                renderMenu();
                startBannerRotation();
                hideLoader();
            } catch (error) {
                console.error('Error:', error);
                showError();
            }
        }

        function hideLoader() {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
        }

        function showError() {
            document.getElementById('loader').innerHTML = `
                <p style="color: var(--accent);">Failed to load menu.</p>
                <button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">Retry</button>
            `;
        }

        // Data Loading
        async function loadData() {
            const response = await fetch(CONFIG.SHEET_URL);
            const csv = await response.text();
            const rows = parseCSV(csv);
            
            rows.forEach((row, idx) => {
                if (!row[0]) return;
                
                if (row[0] === 'Banner') {
                    banners.push({
                        title: row[1],
                        description: row[2],
                        image: row[3],
                        active: row[4]?.toLowerCase() === 'yes'
                    });
                } else {
                    const id = `item-${idx}`;
                    menuData.push({
                        id,
                        type: row[0],
                        name: row[1],
                        category: row[2],
                        price: parseInt(row[3]) || 0,
                        oldPrice: parseInt(row[4]) || 0,
                        description: row[5],
                        image: row[6],
                        tags: row[7]?.split(',').map(t => t.trim()) || [],
                        comboItems: row[8],
                        available: row[9]?.toLowerCase() === 'yes'
                    });
                    quantities[id] = 0;
                }
            });
        }

        function parseCSV(csv) {
            const rows = [];
            let current = [];
            let field = '';
            let inQuotes = false;
            
            for (let i = 0; i < csv.length; i++) {
                const char = csv[i];
                const next = csv[i + 1];
                
                if (!inQuotes && char === '"') {
                    inQuotes = true;
                } else if (inQuotes && char === '"' && next === '"') {
                    field += '"';
                    i++;
                } else if (inQuotes && char === '"') {
                    inQuotes = false;
                } else if (!inQuotes && char === ',') {
                    current.push(field.trim());
                    field = '';
                } else if (!inQuotes && (char === '\n' || char === '\r')) {
                    if (field || current.length) {
                        current.push(field.trim());
                        rows.push(current);
                        current = [];
                        field = '';
                    }
                } else {
                    field += char;
                }
            }
            
            if (field || current.length) {
                current.push(field.trim());
                rows.push(current);
            }
            
            return rows.slice(1); // Skip header
        }

        // Rendering
        function renderBanners() {
            const activeBanners = banners.filter(b => b.active);
            if (!activeBanners.length) return;
            
            const slider = document.getElementById('banner-slider');
            document.getElementById('banner-section').style.display = 'block';
            
            slider.innerHTML = activeBanners.map((b, i) => `
                <div class="banner-slide ${i === 0 ? 'active' : ''}" style="background-image: url('${b.image}')">
                    <div class="banner-content">
                        <div class="banner-title">${b.title}</div>
                        <p>${b.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function startBannerRotation() {
            const slides = document.querySelectorAll('.banner-slide');
            if (slides.length <= 1) return;
            
            setInterval(() => {
                slides[currentBanner].classList.remove('active');
                currentBanner = (currentBanner + 1) % slides.length;
                slides[currentBanner].classList.add('active');
            }, 5000);
        }

        function renderCategories() {
            const categories = [...new Set(menuData.map(i => i.category))];
            const nav = document.getElementById('category-nav');
            const emojis = { 'Beverages': '‚òï', 'Food': 'üçΩÔ∏è', 'Starters': 'ü•ò', 'Main Course': 'üçõ', 'Desserts': 'üç∞', 'Combos': 'üéÅ' };
            
            nav.innerHTML = categories.map((cat, i) => `
                <button class="category-pill ${i === 0 ? 'active' : ''}" onclick="filterCategory('${cat}', this)">
                    ${emojis[cat] || 'üçΩÔ∏è'} ${cat}
                </button>
            `).join('');
        }

        function filterCategory(category, btn) {
            document.querySelectorAll('.category-pill').forEach(p => p.classList.remove('active'));
            btn.classList.add('active');
            renderMenu(category);
        }

        function renderMenu(filterCategory = null) {
            const container = document.getElementById('menu-container');
            const categories = filterCategory ? [filterCategory] : [...new Set(menuData.map(i => i.category))];
            
            container.innerHTML = categories.map(cat => {
                const items = menuData.filter(i => i.category === cat);
                return `
                    <h2 class="section-title">${cat}</h2>
                    <div class="menu-grid">
                        ${items.map(item => renderItem(item)).join('')}
                    </div>
                `;
            }).join('');
        }

        function renderItem(item) {
            const discount = item.oldPrice ? Math.round((1 - item.price/item.oldPrice) * 100) : 0;
            
            return `
                <div class="menu-item ${!item.available ? 'unavailable' : ''}">
                    <div class="item-image-container">
                        ${item.image ? `<img src="${item.image}" class="item-image" alt="${item.name}" onerror="this.style.display='none'">` : ''}
                        <div class="item-badges">
                            ${item.tags.map(tag => {
                                const cls = tag.toLowerCase().includes('new') ? 'new' : 
                                           tag.toLowerCase().includes('sale') ? 'sale' : 'bestseller';
                                return `<span class="badge badge-${cls}">${tag}</span>`;
                            }).join('')}
                        </div>
                        ${!item.available ? '<div class="unavailable-overlay">Out of Stock</div>' : ''}
                    </div>
                    <div class="item-content">
                        <div class="item-header">
                            <div class="item-name">${item.name}</div>
                        </div>
                        ${item.description ? `<div class="item-description">${item.description}</div>` : ''}
                        ${item.comboItems ? `<div class="combo-includes"><strong>Includes:</strong> ${item.comboItems}</div>` : ''}
                        <div class="price-section">
                            <span class="current-price">‚Çπ${item.price}</span>
                            ${item.oldPrice ? `<span class="old-price">‚Çπ${item.oldPrice}</span>` : ''}
                            ${discount > 0 ? `<span class="discount-badge">-${discount}%</span>` : ''}
                        </div>
                        ${item.oldPrice ? `<div class="savings">üí∞ You save ‚Çπ${item.oldPrice - item.price}!</div>` : ''}
                        <div class="item-actions">
                            <div class="quantity-control">
                                <button class="qty-btn" onclick="changeQty('${item.id}', -1)" ${!item.available ? 'disabled' : ''}>‚àí</button>
                                <span class="qty-display" id="qty-${item.id}">0</span>
                                <button class="qty-btn" onclick="changeQty('${item.id}', 1)" ${!item.available ? 'disabled' : ''}>+</button>
                            </div>
                            <button class="add-btn" onclick="addToCart('${item.id}')" ${!item.available ? 'disabled' : ''}>
                                ${item.available ? 'Add to Cart' : 'Unavailable'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Cart Functions
        function changeQty(id, delta) {
            const item = menuData.find(i => i.id === id);
            if (!item?.available) return;
            
            quantities[id] = Math.max(0, quantities[id] + delta);
            document.getElementById(`qty-${id}`).textContent = quantities[id];
        }

        function addToCart(id) {
            const qty = quantities[id];
            if (!qty) {
                alert('Please select quantity first');
                return;
            }
            
            const item = menuData.find(i => i.id === id);
            if (cart[id]) {
                cart[id].qty += qty;
            } else {
                cart[id] = { ...item, qty };
            }
            
            quantities[id] = 0;
            document.getElementById(`qty-${id}`).textContent = '0';
            
            updateCartCount();
            
            // Visual feedback
            const btn = event.target;
            btn.textContent = '‚úì Added!';
            btn.style.background = 'var(--secondary)';
            setTimeout(() => {
                btn.textContent = 'Add to Cart';
                btn.style.background = '';
            }, 1000);
        }

        function updateCartCount() {
            const count = Object.values(cart).reduce((sum, i) => sum + i.qty, 0);
            document.getElementById('cart-count').textContent = count;
            document.getElementById('cart-count-mobile').textContent = count;
        }

        function openCart() {
            renderCart();
            document.getElementById('cart-modal').classList.add('active');
        }

        function closeCart() {
            document.getElementById('cart-modal').classList.remove('active');
        }

        function renderCart() {
            const items = Object.values(cart);
            const body = document.getElementById('cart-body');
            
            if (!items.length) {
                body.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">üõí</div>
                        <h3>Your cart is empty</h3>
                        <p>Add some delicious items!</p>
                    </div>
                `;
                return;
            }
            
            const total = items.reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            body.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    ${items.map(item => `
                        <div class="cart-item">
                            <img src="${item.image || ''}" class="cart-item-img" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect fill=%22%23f3f4f6%22 width=%2280%22 height=%2280%22/></svg>'">
                            <div class="cart-item-details">
                                <div class="cart-item-name">${item.name}</div>
                                <div class="cart-item-price">‚Çπ${item.price}</div>
                                <div class="cart-item-qty">
                                    <button class="cart-qty-btn" onclick="updateCartQty('${item.id}', -1)">‚àí</button>
                                    <span>${item.qty}</span>
                                    <button class="cart-qty-btn" onclick="updateCartQty('${item.id}', 1)">+</button>
                                </div>
                            </div>
                            <div style="font-weight: 700;">‚Çπ${item.price * item.qty}</div>
                            <button class="remove-btn" onclick="removeFromCart('${item.id}')">üóë</button>
                        </div>
                    `).join('')}
                </div>
                <div class="cart-summary">
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>‚Çπ${total}</span>
                    </div>
                    <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout</button>
                </div>
            `;
        }

        function updateCartQty(id, delta) {
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            updateCartCount();
            renderCart();
        }

        function removeFromCart(id) {
            delete cart[id];
            updateCartCount();
            renderCart();
        }

        // Checkout
        function openCheckout() {
            closeCart();
            const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
            
            document.getElementById('checkout-body').innerHTML = `
                <form id="order-form" onsubmit="submitOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Name <span class="required">*</span></label>
                        <input type="text" class="form-input" id="cust-name" required placeholder="Your name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone <span class="required">*</span></label>
                        <input type="tel" class="form-input" id="cust-phone" required placeholder="+91 98765 43210">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Order Type <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="order-type" value="dine-in" id="type-dine" onchange="toggleFields()" required>
                                <label class="radio-label" for="type-dine">üçΩÔ∏è Dine In</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="order-type" value="pickup" id="type-pickup" onchange="toggleFields()">
                                <label class="radio-label" for="type-pickup">üõçÔ∏è Pickup</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="conditional-fields" id="dine-fields">
                        <label class="form-label">Table Number <span class="required">*</span></label>
                        <select class="form-input" id="table-num">
                            <option value="">Select Table</option>
                            ${Array.from({length: CONFIG.TOTAL_TABLES}, (_, i) => 
                                `<option value="${i+1}">Table ${i+1}</option>`
                            ).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Special Instructions</label>
                        <textarea class="form-input" id="instructions" rows="3" placeholder="Any special requests..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Payment Method <span class="required">*</span></label>
                        <div class="payment-options">
                            <div class="payment-option" onclick="selectPayment('counter')">
                                <span class="payment-icon">üíµ</span>
                                <div>
                                    <div class="payment-title">Pay at Counter</div>
                                    <div class="payment-subtitle">Cash/Card/UPI at cafe</div>
                                </div>
                            </div>
                            <div class="payment-option" onclick="selectPayment('upi')">
                                <span class="payment-icon">üì±</span>
                                <div>
                                    <div class="payment-title">Pay Now (UPI)</div>
                                    <div class="payment-subtitle">Quick online payment</div>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="payment-method" required>
                    </div>
                    
                    <div style="background: var(--bg); padding: 1rem; border-radius: 12px; margin: 1rem 0;">
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.25rem;">
                            <span>Total Amount:</span>
                            <span style="color: var(--primary);">‚Çπ${total}</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="checkout-btn">Place Order</button>
                </form>
            `;
            
            document.getElementById('checkout-modal').classList.add('active');
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.remove('active');
        }

        function toggleFields() {
            const isDine = document.getElementById('type-dine').checked;
            document.getElementById('dine-fields').classList.toggle('active', isDine);
        }

        function selectPayment(method) {
            document.querySelectorAll('.payment-option').forEach(p => p.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('payment-method').value = method;
        }

        // Order Submission
        function submitOrder(e) {
            e.preventDefault();
            
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const type = document.querySelector('input[name="order-type"]:checked')?.value;
            const payment = document.getElementById('payment-method').value;
            const instructions = document.getElementById('instructions').value;
            
            if (!payment) {
                alert('Please select payment method');
                return;
            }
            
            let location = '';
            if (type === 'dine-in') {
                const table = document.getElementById('table-num').value;
                if (!table) {
                    alert('Please select table number');
                    return;
                }
                location = `Table ${table}`;
            } else {
                location = 'Pickup Counter';
            }
            
            const items = Object.values(cart).map(i => `${i.qty}x ${i.name}`).join(', ');
            const total = Object.values(cart).reduce((sum, i) => sum + (i.price * i.qty), 0);
            const orderId = 'SN' + Date.now().toString().slice(-6);
            
            const orderData = {
                orderId,
                timestamp: new Date().toLocaleString('en-IN'),
                name,
                phone,
                items,
                total,
                type: type === 'dine-in' ? 'Dine In' : 'Pickup',
                location,
                payment: payment === 'upi' ? 'UPI (Pending)' : 'Pay at Counter',
                instructions,
                status: 'PENDING'
            };
            
            // Save to localStorage for admin panel
            saveOrder(orderData);
            
            if (payment === 'upi') {
                showUPIScreen(orderData, total);
            } else {
                completeOrder(orderData);
            }
        }

        function saveOrder(order) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            orders.unshift(order);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            // Trigger notification for admin
            localStorage.setItem('newOrder', Date.now());
        }

        function showUPIScreen(order, amount) {
            document.getElementById('checkout-body').innerHTML = `
                <div class="success-screen">
                    <div class="upi-amount">‚Çπ${amount}</div>
                    <div class="upi-steps">
                        <div style="font-weight: 700; margin-bottom: 1rem; color: var(--primary);">üì± UPI Payment Steps:</div>
                        <ol>
                            <li>Click "Open UPI App" below</li>
                            <li>Complete payment in your UPI app</li>
                            <li>Return here and click "Payment Done"</li>
                            <li>Send WhatsApp confirmation</li>
                        </ol>
                    </div>
                    <button class="checkout-btn" onclick="openUPI('${order.orderId}', ${amount})" style="margin-bottom: 1rem;">
                        Open UPI App
                    </button>
                    <button class="checkout-btn" onclick="completeOrderAfterUPI('${order.orderId}')" style="background: var(--secondary);">
                        Payment Done - Confirm Order
                    </button>
                </div>
            `;
        }

        function openUPI(orderId, amount) {
            const upiLink = `upi://pay?pa=${CONFIG.UPI_ID}&pn=${encodeURIComponent(CONFIG.BUSINESS_NAME)}&am=${amount}&cu=INR&tn=Order_${orderId}`;
            window.location.href = upiLink;
        }

        function completeOrderAfterUPI(orderId) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const order = orders.find(o => o.orderId === orderId);
            if (order) {
                order.payment = 'UPI (Paid)';
                localStorage.setItem('orders', JSON.stringify(orders));
                completeOrder(order);
            }
        }

        function completeOrder(order) {
            // Send WhatsApp
            const msg = `*New Order - ${CONFIG.BUSINESS_NAME}*%0A%0A` +
                       `üÜî Order: ${order.orderId}%0A` +
                       `üë§ ${order.name}%0A` +
                       `üì± ${order.phone}%0A` +
                       `üìç ${order.location}%0A` +
                       `üçΩÔ∏è ${order.type}%0A%0A` +
                       `*Items:*%0A${order.items.replace(/,/g, '%0A')}%0A%0A` +
                       `üí∞ Total: ‚Çπ${order.total}%0A` +
                       `üí≥ ${order.payment}%0A` +
                       `${order.instructions ? 'üìù ' + order.instructions : ''}`;
            
            window.open(`https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${msg}`, '_blank');
            
            // Show success
            document.getElementById('checkout-body').innerHTML = `
                <div class="success-screen">
                    <div class="success-icon">‚úì</div>
                    <h2 style="color: var(--secondary); margin-bottom: 1rem;">Order Placed!</h2>
                    <div class="order-id-box">
                        <div class="order-id-label">Your Order ID</div>
                        <div class="order-id">${order.orderId}</div>
                    </div>
                    <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                        We've sent details to the kitchen.<br>
                        ${order.type === 'Dine In' ? 'Your food will be served at ' + order.location : 'Please collect from pickup counter when ready.'}
                    </p>
                    <button class="checkout-btn" onclick="closeAllAndReset()">Continue Shopping</button>
                </div>
            `;
            
            // Clear cart
            cart = {};
            quantities = {};
            updateCartCount();
        }

        function closeAllAndReset() {
            closeCheckout();
            renderMenu();
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.remove('active');
            });
        });
    </script>
</body>
</html>
